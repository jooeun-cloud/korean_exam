import streamlit as st
import pandas as pd
from datetime import datetime
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import altair as alt

# --------------------------------------------------
# [0] ê¸°ë³¸ ì„¤ì •
# --------------------------------------------------
st.set_page_config(page_title="êµ­ì–´ ëª¨ì˜ê³ ì‚¬ í†µí•© ì‹œìŠ¤í…œ", page_icon="ğŸ“š", layout="wide")

GRADE_ORDER = ["ì¤‘ 1í•™ë…„", "ì¤‘ 2í•™ë…„", "ì¤‘ 3í•™ë…„", "ê³  1í•™ë…„", "ê³  2í•™ë…„", "ê³  3í•™ë…„"]

# --------------------------------------------------
# [1] ê´€ë¦¬ì ê³„ì • ë¶ˆëŸ¬ì˜¤ê¸°
# --------------------------------------------------
@st.cache_data(ttl=600)
def load_admins():
    if "gcp_service_account" not in st.secrets:
        return {}

    scope = ['https://spreadsheets.google.com/feeds', 'https://www.googleapis.com/auth/drive']
    creds = ServiceAccountCredentials.from_json_keyfile_dict(
        dict(st.secrets["gcp_service_account"]), scope
    )
    client = gspread.authorize(creds)

    admins = {}
    try:
        sheet = client.open("ExamResults").worksheet("Admins")
        records = sheet.get_all_records()

        for row in records:
            admin_id = str(row.get("AdminID", "")).strip()
            if not admin_id:
                continue

            admins[admin_id] = {
                "password": str(row.get("Password", "")).strip(),
                "role": str(row.get("Role", "admin")).strip().lower()  # admin / superadmin
            }
    except Exception as e:
        st.error(f"ê´€ë¦¬ì ì‹œíŠ¸ ë¡œë”© ì˜¤ë¥˜: {e}")

    return admins


ADMINS = load_admins()

# --------------------------------------------------
# [2] ë¡œê·¸ì¸ ì²˜ë¦¬
# --------------------------------------------------
with st.sidebar:
    st.header("ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸")

    # ì„¸ì…˜ ê¸°ë³¸ê°’ ì„¤ì •
    if "is_authenticated" not in st.session_state:
        st.session_state["is_authenticated"] = False
        st.session_state["admin_id"] = None
        st.session_state["is_superadmin"] = False

    if not st.session_state["is_authenticated"]:
        admin_id_input = st.text_input("ê´€ë¦¬ì ID")
        pw_input = st.text_input("ë¹„ë°€ë²ˆí˜¸", type="password")

        if st.button("ë¡œê·¸ì¸"):
            admin_info = ADMINS.get(admin_id_input)

            if admin_info and pw_input == admin_info["password"]:
                st.session_state["is_authenticated"] = True
                st.session_state["admin_id"] = admin_id_input
                st.session_state["is_superadmin"] = (admin_info["role"] == "superadmin")
                st.success(f"âœ… {admin_id_input} ë¡œê·¸ì¸ ì„±ê³µ")
                # ğŸ” ë³„ë„ì˜ rerun í•„ìš” ì—†ìŒ (Streamlitì´ ìë™ìœ¼ë¡œ ì¬ì‹¤í–‰í•¨)
            else:
                st.error("âŒ ID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.")
    else:
        role_label = "ìµœì¢…ê´€ë¦¬ì" if st.session_state["is_superadmin"] else "ì¼ë°˜ ê´€ë¦¬ì"
        st.success(f"ì ‘ì† ê³„ì •: {st.session_state['admin_id']}")
        st.caption(f"ê¶Œí•œ : {role_label}")

        st.markdown("---")
        if st.button("ğŸ”„ ë¬¸ì œ DB ìƒˆë¡œê³ ì¹¨"):
            st.cache_data.clear()
            st.success("ë¬¸ì œ DB ìºì‹œë¥¼ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤. (ë‹¤ìŒ í™”ë©´ë¶€í„° ë°˜ì˜ë©ë‹ˆë‹¤)")

        if st.button("ë¡œê·¸ì•„ì›ƒ"):
            for k in ["is_authenticated", "admin_id", "is_superadmin"]:
                st.session_state.pop(k, None)
            st.success("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.")
            # ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ì•± ì¤‘ë‹¨
if not st.session_state.get("is_authenticated", False):
    st.warning("ì´ ì‹œìŠ¤í…œì€ ê´€ë¦¬ì ì „ìš©ì…ë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.")
    st.stop()

current_admin = st.session_state.get("admin_id")
is_superadmin = st.session_state.get("is_superadmin", False)
is_admin = True


# --------------------------------------------------
# [3] ì •ë‹µ DB ë¡œë“œ
# --------------------------------------------------
@st.cache_data(ttl=600)
def load_exam_db():
    if "gcp_service_account" not in st.secrets:
        return {}

    scope = ['https://spreadsheets.google.com/feeds', 'https://www.googleapis.com/auth/drive']
    creds = ServiceAccountCredentials.from_json_keyfile_dict(dict(st.secrets["gcp_service_account"]), scope)
    client = gspread.authorize(creds)

    db = {}

    for grade in GRADE_ORDER:
        try:
            sheet_name = f"ì •ë‹µ_{grade}"
            sheet = client.open("ExamResults").worksheet(sheet_name)
            records = sheet.get_all_records()

            if grade not in db:
                db[grade] = {}

            for row in records:
                round_name = str(row['Round']).strip()
                q_num = int(row['Q_Num'])

                if round_name not in db[grade]:
                    db[grade][round_name] = {}

                db[grade][round_name][q_num] = {
                    "ans": int(row['Answer']),
                    "score": int(row['Score']),
                    "type": str(row['Type']).strip()
                }

        except gspread.WorksheetNotFound:
            continue
        except Exception as e:
            st.error(f"'{grade}' ì •ë‹µ ë¡œë”© ì˜¤ë¥˜: {e}")

    return db


EXAM_DB = load_exam_db()

# --------------------------------------------------
# [4] í•™ìƒ ì‹œíŠ¸ (Sheet1)
# --------------------------------------------------
def get_student_sheet():
    if "gcp_service_account" not in st.secrets:
        return None

    scope = ['https://spreadsheets.google.com/feeds', 'https://www.googleapis.com/auth/drive']
    creds = ServiceAccountCredentials.from_json_keyfile_dict(dict(st.secrets["gcp_service_account"]), scope)
    client = gspread.authorize(creds)

    try:
        return client.open("ExamResults").sheet1
    except Exception as e:
        st.error(f"ì‹œíŠ¸ ì—°ê²° ì˜¤ë¥˜: {e}")
        return None

# --------------------------------------------------
# [5] í”¼ë“œë°± í•¨ìˆ˜
# --------------------------------------------------
# ì„¸ë¶„í™”ëœ Type ê°’ì— ëŒ€í•œ ì „ìš© í”¼ë“œë°±
FEEDBACK_BY_TYPE = {
    "í™”ë²•(ê°•ì—°-ë§í•˜ê¸° ì „ëµ)": """### ğŸ—£ï¸ í™”ë²•: ê°•ì—°ì—ì„œì˜ ë§í•˜ê¸° ì „ëµ
**1. ì§„ë‹¨**  
ê°•ì—° ë‚´ìš©ì„ ì´í•´í•˜ëŠ” ë° ì§‘ì¤‘í•˜ëŠë¼, í™”ìê°€ ì‚¬ìš©í•œ **ë§í•˜ê¸° ì „ëµ(ì˜ˆì‹œ, ë¹„êµ, ì§ˆë¬¸, ê°•ì¡°)**ì„ êµ¬ë¶„í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ê·¸ë˜ì„œ ë¹„ìŠ·í•œ ì„ ì§€ ì‚¬ì´ì—ì„œ ê³„ì† í—·ê°ˆë¦½ë‹ˆë‹¤.

**2. Action Plan**  
1. ì§€ë¬¸ì„ ì½ì„ ë•Œ ì¤‘ìš”í•œ ë¬¸ì¥ ì˜†ì— `[ì˜ˆì‹œ] [ë¹„êµ] [ì§ˆë¬¸] [ê°•ì¡°]`ì²˜ëŸ¼ ì „ëµ ì´ë¦„ì„ ì§ì ‘ ì ê²Œ í•˜ì„¸ìš”.  
2. ê° ì „ëµì´ ì“°ì¸ ë¬¸ì¥ë§ˆë‹¤ â€œì´ ì „ëµì„ ì“°ë©´ ì²­ìê°€ ì–´ë–¤ ëŠë‚Œ/ì •ë³´ë¥¼ ë” ì˜ ë°›ëŠ”ê°€?â€ë¥¼ ë§ë¡œ ì„¤ëª…í•˜ê²Œ í•´ ë³´ì„¸ìš”.  
3. ë§ˆì§€ë§‰ì—ëŠ” ë°˜ë“œì‹œ **â€œì´ í™”ìëŠ” ë¬´ì—‡ì„ í•˜ê²Œ ë§Œë“¤ë ¤ê³  ì´ ë§ì„ í–ˆì„ê¹Œ?â€**ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•˜ê²Œ í•˜ì„¸ìš”.""",

    "í™”ë²•(ê°•ì—°-ì‹œê° ìë£ŒÂ·ì˜ˆì‹œ í™œìš©)": """### ğŸ—£ï¸ í™”ë²•: ì‹œê° ìë£ŒÂ·ì˜ˆì‹œ í™œìš©
**1. ì§„ë‹¨**  
ê·¸ë˜í”„Â·ì‚¬ì§„Â·ë„í‘œ ë“±ì„ ê·¸ëƒ¥ â€˜ê¾¸ë¯¸ê¸°ìš© ê·¸ë¦¼â€™ì²˜ëŸ¼ ë³´ê³ , **ë§í•˜ê¸° ë‚´ìš©ê³¼ ì—°ê²°ëœ ê¸°ëŠ¥**ìœ¼ë¡œ í•´ì„í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ì‹œê° ìë£Œê°€ ë‚˜ì˜¬ ë•Œë§ˆë‹¤ ì˜†ì— **â€œì´ ìë£Œê°€ ì—†ìœ¼ë©´ ì–´ë–¤ ì •ë³´ê°€ ì•½í•´ì§ˆê¹Œ?â€**ë¥¼ ì ê²Œ í•˜ì„¸ìš”. (ì´í•´ ë³´ì¡° / ì„¤ë“ ê°•í™” / ë¹„êµ ê°•ì¡° ì¤‘ ë¬´ì—‡ì¸ì§€)  
2. ìë£Œì— ë‹´ê¸´ í•µì‹¬ ìˆ«ìÂ·ë³€í™” ë°©í–¥ë§Œ ë½‘ì•„ì„œ í•œ ì¤„ë¡œ ìš”ì•½í•˜ê²Œ í•˜ì„¸ìš”.  
3. ì„ ì§€ì—ì„œ ì‹œê° ìë£Œì˜ â€˜ì—­í• â€™ì„ ë¬»ëŠ”ì§€, â€˜ë‚´ìš©â€™ ìì²´ë¥¼ ë¬»ëŠ”ì§€ ë¨¼ì € êµ¬ë¶„í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "í™”ë²•(ê°•ì—°-ì²­ì ë°˜ì‘Â·ì´í•´ í‰ê°€)": """### ğŸ—£ï¸ í™”ë²•: ì²­ì ë°˜ì‘Â·ì´í•´ í‰ê°€
**1. ì§„ë‹¨**  
ì²­ìì˜ ì§ˆë¬¸Â·ê³ ê°œ ë„ë•ì„Â·ì›ƒìŒ ë“±ì„ ë‹¨ìˆœí•œ í–‰ë™ ë¬˜ì‚¬ë¡œë§Œ ë³´ê³ , **ì´ ë°˜ì‘ì´ ì´í•´/í‰ê°€/ê³µê°/ë°˜ë°• ì¤‘ ë¬´ì—‡ì¸ì§€**ë¥¼ êµ¬ë¶„í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ì²­ì ë°œí™”ë§ˆë‹¤ ì˜†ì— `[ì´í•´ í™•ì¸] [ê³µê°] [ë¹„íŒ] [ì¶”ê°€ ì§ˆë¬¸]`ì²˜ëŸ¼ ë“£ê¸° ìœ í˜• ê¼¬ë¦¬í‘œë¥¼ ë¶™ì´ê²Œ í•˜ì„¸ìš”.  
2. â€œì´ ë°˜ì‘ì´ ë‚˜ì˜¤ë©´, í™”ìëŠ” ë‹¤ìŒì— ì–´ë–¤ ì „ëµìœ¼ë¡œ ì´ì–´ê°ˆê¹Œ?â€ë¥¼ ì˜ˆì¸¡í•˜ê²Œ í•´ ë³´ì„¸ìš”.  
3. ì„ ì§€ë¥¼ ë³¼ ë•ŒëŠ”, ë°˜ì‘ì˜ **ë‚´ìš©**ì´ ì•„ë‹ˆë¼ ê·¸ ë°˜ì‘ì´ ê°€ì§„ **ê¸°ëŠ¥(ì—­í• )**ì„ ê¸°ì¤€ìœ¼ë¡œ ì˜³ê³  ê·¸ë¦„ì„ íŒë‹¨í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¬¸ë²•-ìŒìš´(ë¹„ìŒí™”Â·ìœ ìŒí™” ê°œë… ì´í•´)": """### ğŸ§¬ ë¬¸ë²•: ë¹„ìŒí™”Â·ìœ ìŒí™” ê°œë… ì •ë¦¬
**1. ì§„ë‹¨**  
ë¹„ìŒí™”Â·ìœ ìŒí™”ì˜ ì •ì˜ëŠ” ì™¸ì› ì§€ë§Œ, **ì‹¤ì œ ë‹¨ì–´ì—ì„œ â€˜ì™œâ€™ ê·¸ëŸ° ë³€í™”ê°€ ì¼ì–´ë‚˜ëŠ”ì§€**ë¥¼ ì„¤ëª…í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ë°›ì¹¨ ë’¤ì— ì˜¤ëŠ” ì†Œë¦¬ë¥¼ ì œëŒ€ë¡œ ë³´ì§€ ì•Šê³  ì •ë‹µì„ ê³ ë¥¸ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. í•­ìƒ **â€˜ë°›ì¹¨ + ë’¤ ìŒìš´â€™** êµ¬ì¡°ë¡œ ë‹¨ì–´ë¥¼ ìª¼ê°œ ë³´ê²Œ í•˜ì„¸ìš”. (ì˜ˆ: [êµ­+ë¬¼] â†’ [ê¶ë¬¼])  
2. ë¹„ìŒí™” = ë’¤ì— **[ã„´, ã…, ã…‡] ë¹„ìŒ**ì´ ì˜¬ ë•Œ, ìœ ìŒí™” = **ã„´ì´ ã„¹ ì•ì—ì„œ ã„¹ë¡œ ë°”ë€œ**ì´ë¼ëŠ” ìµœì†Œí•œì˜ ì¡°ê±´ì„ ë§ë¡œ ì„¤ëª…í•˜ê²Œ í•˜ì„¸ìš”.  
3. ë¬¸ì œë¥¼ í’€ ë•Œ, ë¨¼ì € â€œì–´ë–¤ ìŒì´ ì–´ë–¤ ìŒ ì˜†ìœ¼ë¡œ ê°”ëŠ”ì§€â€ë¥¼ ì…ìœ¼ë¡œ ì½ì–´ ë³´ê³ , ê·¸ë‹¤ìŒì— ìš©ì–´(ë¹„ìŒí™”/ìœ ìŒí™”)ë¥¼ ë¶™ì´ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¬¸ë²•-ìŒìš´(êµ¬ê°œìŒí™”-ì¡°ìŒ ìœ„ì¹˜Â·í™˜ê²½ ë¶„ì„)": """### ğŸ§¬ ë¬¸ë²•: êµ¬ê°œìŒí™”(ì¡°ìŒ ìœ„ì¹˜Â·í™˜ê²½)
**1. ì§„ë‹¨**  
êµ¬ê°œìŒí™”ë¥¼ â€˜ã„·/ã…Œ + ì´ â†’ ã…ˆ/ã…Šâ€™ ê³µì‹ìœ¼ë¡œë§Œ ì™¸ìš°ê³ , **ë’¤ì— ì˜¤ëŠ” ëª¨ìŒÂ·ììŒ í™˜ê²½**ì„ ì œëŒ€ë¡œ ë³´ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ì¡°ìŒ ìœ„ì¹˜ê°€ ì•ìª½(ì…ì²œì¥ ìª½)ìœ¼ë¡œ ì˜®ê²¨ì§€ëŠ” ì›ë¦¬ë¥¼ ì´í•´í•˜ì§€ ëª»í•œ ìƒíƒœì…ë‹ˆë‹¤.

**2. Action Plan**  
1. ë‹¨ì–´ë¥¼ í•­ìƒ `[ììŒ + ëª¨ìŒ]` ë‹¨ìœ„ë¡œ ëŠê³ , **ã„·Â·ã…Œ ë’¤ì— ã…£(ë˜ëŠ” ã…•, ã…›, ã…  ë“± ã…£ ê³„ì—´ ëª¨ìŒ)**ì´ ì˜¤ëŠ”ì§€ ë¨¼ì € ì²´í¬í•˜ê²Œ í•˜ì„¸ìš”.  
2. êµ¬ê°œìŒí™”ëŠ” â€œí˜€ì˜ ë‹¿ëŠ” ìœ„ì¹˜ê°€ ì•ìª½(ê²½êµ¬ê°œ)ìœ¼ë¡œ ë‹¹ê²¨ì§„ë‹¤â€ëŠ” ê·¸ë¦¼ì„ í•¨ê»˜ ë³´ì—¬ ì£¼ë©° ì„¤ëª…í•˜ë©´ ê¸°ì–µì´ ì˜¤ë˜ ê°‘ë‹ˆë‹¤.  
3. ìŒì„± ë³€í™” ê³¼ì •ì„ **/ë””/ â†’ [ì§€]**ì²˜ëŸ¼ ê¸°í˜¸ë¡œ ì ì–´ ë³´ê²Œ í•˜ê³ , ê·¸ ë’¤ì— ìš©ì–´(êµ¬ê°œìŒí™”)ë¥¼ ë¶™ì´ë„ë¡ ì—°ìŠµì‹œí‚¤ì„¸ìš”.""",

    "ë¬¸ë²•-ë¬¸ì¥ ì„±ë¶„/êµ¬ë¬¸ ë„í•´(ì£¼ì–´Â·ëª©ì ì–´Â·ì¡°ì‚¬)": """### ğŸ§± ë¬¸ë²•: ë¬¸ì¥ ì„±ë¶„Â·êµ¬ë¬¸ ë„í•´
**1. ì§„ë‹¨**  
ë¬¸ì¥ì„ ë‹¨ì–´ ë‚˜ì—´ë¡œë§Œ ë³´ê³ , **ì„œìˆ ì–´-ì£¼ì–´-ëª©ì ì–´ ê´€ê³„ë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ íŒŒì•…í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±**ì´ í½ë‹ˆë‹¤. íŠ¹íˆ ì¡°ì‚¬ë¥¼ ê·¸ëƒ¥ ë‹¨ì–´ì˜ ì¼ë¶€ë¡œ ë³´ê³ , ë¬¸ì¥ ì„±ë¶„ì˜ ì—­í• ì„ êµ¬ë¶„í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

**2. Action Plan**  
1. ì–´ë–¤ ë¬¸ì¥ì´ë“  ë¨¼ì € **ì„œìˆ ì–´(ë™ì‚¬Â·í˜•ìš©ì‚¬)**ì— ë°‘ì¤„ì„ ê¸‹ê²Œ í•˜ì„¸ìš”.  
2. ê·¸ë‹¤ìŒ â€œëˆ„ê°€(ì£¼ì–´), ë¬´ì—‡ì„(ëª©ì ì–´), ì–´ë–¤ ìƒíƒœê°€ ë˜ê²Œ í•˜ëŠ”ê°€(ë³´ì–´)â€ë¥¼ ì§ˆë¬¸ìœ¼ë¡œ ë˜ì§€ë©° í•´ë‹¹ ì„±ë¶„ì„ ì°¾ê²Œ í•©ë‹ˆë‹¤.  
3. ì¡°ì‚¬ëŠ” â€˜ê¾¸ë©°ì£¼ëŠ” ê¼¬ë¦¬í‘œâ€™ë¼ëŠ” ê²ƒì„ ê°•ì¡°í•˜ê³ , ì²´ì–¸ê³¼ ë¶„ë¦¬í•´ì„œ í‘œì‹œí•˜ëŠ” ì—°ìŠµ(ì˜ˆ: í•™ìƒ/ì´, ì±…/ì„)ì„ ë°˜ë³µì‹œí‚¤ì„¸ìš”.""",

    "ë¬¸ë²•-ì‚¬ì „ ì •ë³´ í•´ì„(ìˆë‹¤/ì—†ë‹¤-ë°œìŒÂ·í’ˆì‚¬)": """### ğŸ“– ë¬¸ë²•: ì‚¬ì „ ì •ë³´(ë°œìŒÂ·í’ˆì‚¬)
**1. ì§„ë‹¨**  
ì‚¬ì „ ëœ»í’€ì´ì—ì„œ **ë°œìŒ ê¸°í˜¸ì™€ í’ˆì‚¬ ì •ë³´**ë¥¼ ê±´ë„ˆë›°ê³ , ëœ»í’€ì´ë§Œ ë³´ê³  íŒë‹¨í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ê·¸ë˜ì„œ ê°™ì€ í‘œê¸°ì˜ ë‹¤ë¥¸ í’ˆì‚¬ë¥¼ êµ¬ë³„í•˜ì§€ ëª»í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. ì‚¬ì „ ë¬¸ì œê°€ ë‚˜ì˜¤ë©´ ë¨¼ì € **ë°œìŒ ê¸°í˜¸, í’ˆì‚¬, ë¬¸í˜•** ìˆœìœ¼ë¡œ í‘œì‹œí•˜ê²Œ í•˜ì„¸ìš”. (ëœ»ì€ ê·¸ë‹¤ìŒ)  
2. ì˜ˆë¬¸ì„ ë³¼ ë•Œ â€œì´ ì˜ˆë¬¸ì—ì„œëŠ” ì–´ë–¤ í’ˆì‚¬ë¡œ ì“°ì˜€ëŠ”ì§€â€ë¥¼ ë™ê·¸ë¼ë¯¸ ì¹˜ê²Œ í•˜ì—¬, í’ˆì‚¬-ëœ»í’€ì´-ì˜ˆë¬¸ì´ ì„œë¡œ ì–´ë–»ê²Œ ëŒ€ì‘ë˜ëŠ”ì§€ ì—°ê²°í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.  
3. â€˜ìˆë‹¤/ì—†ë‹¤â€™ì²˜ëŸ¼ ì¼ìƒì  ë‹¨ì–´ì¼ìˆ˜ë¡ í’ˆì‚¬ê°€ ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ê°•ì¡°í•´ ì£¼ì„¸ìš”.""",

    "ë¬¸ë²•-ì‚¬ì „ ì •ë³´ í•´ì„(ìˆë‹¤/ì—†ë‹¤-ì˜ë¯¸Â·ìš©ë¡€ ì ìš©)": """### ğŸ“– ë¬¸ë²•: ì‚¬ì „ ì˜ë¯¸Â·ìš©ë¡€ ì ìš©
**1. ì§„ë‹¨**  
ì‚¬ì „ì—ì„œ ì œì‹œí•œ **ì—¬ëŸ¬ ê°œì˜ ì˜ë¯¸ ì¤‘ ì–´ëŠ ì˜ë¯¸ê°€ ë¬¸ì œ ì† ë¬¸ì¥ì— í•´ë‹¹í•˜ëŠ”ì§€**ë¥¼ ê³ ë¥´ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¬¸ì¥ ì† ì“°ì„ì„ ì •í™•íˆ íŒŒì•…í•˜ì§€ ëª»í•œ ìƒíƒœì…ë‹ˆë‹¤.

**2. Action Plan**  
1. ë¨¼ì € ë¬¸ì œì— ë‚˜ì˜¨ ë¬¸ì¥ì„ ìì‹ ì˜ ë§ë¡œ í’€ì–´ ì“°ê²Œ í•˜ì—¬, ì‹¤ì œ ì˜ë¯¸ë¥¼ ëª…í™•íˆ í•˜ê²Œ í•˜ì„¸ìš”.  
2. ê·¸ë‹¤ìŒ ì‚¬ì „ ëœ»í’€ì´ ê° í•­ëª© ì˜†ì— â€œë¹„ìŠ·í•œ ë§â€ì„ í•˜ë‚˜ì”© ì ì–´ ë³´ê²Œ í•˜ê³ , ë¬¸ì œ ì† ë¬¸ì¥ê³¼ ê°€ì¥ ì˜ ë§ëŠ” í•­ëª©ì„ ê³ ë¥´ê²Œ ì§€ë„í•˜ì„¸ìš”.  
3. ë¹„ìŠ·í•´ ë³´ì´ëŠ” ì˜ë¯¸ë¥¼ êµ¬ë¶„í•  ë•ŒëŠ” â€˜ëŒ€ìƒâ€™ê³¼ â€˜ìƒí™©â€™ì„ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ„ê²Œ í•˜ì„¸ìš” (ì˜ˆ: ì¡´ì¬/ì†Œìœ /ê²½í—˜ ë“±).""",

    "ë¹„ë¬¸í•™-ì¸ë¬¸/ì² í•™(í„Â·ë°ì¹´ë¥´íŠ¸-ì§„ë¦¬ê´€ ë¹„êµ)": """### ğŸ§  ì¸ë¬¸/ì² í•™: í„Â·ë°ì¹´ë¥´íŠ¸ ì§„ë¦¬ê´€ ë¹„êµ
**1. ì§„ë‹¨**  
ë‘ ì‚¬ìƒê°€ì˜ ì…ì¥ì„ ë”°ë¡œë”°ë¡œ ì™¸ìš°ê³ , **ì–´ë–¤ ê¸°ì¤€ì—ì„œ ëŒ€ë¦½í•˜ëŠ”ì§€**ë¥¼ í‘œë¡œ ì •ë¦¬í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤. ê·¸ë˜ì„œ ì„ ì§€ì—ì„œ ê´€ì ì´ ì„ì—¬ ë‚˜ì˜¬ ë•Œ ì‰½ê²Œ í—·ê°ˆë¦½ë‹ˆë‹¤.

**2. Action Plan**  
1. ì§€ë¬¸ì—ì„œ ì² í•™ìê°€ ë‘ ëª… ì´ìƒ ë‚˜ì˜¤ë©´, ë°˜ë“œì‹œ ë‹¤ìŒ í‹€ë¡œ ì •ë¦¬í•˜ê²Œ í•˜ì„¸ìš”.  
   - í„: ê²½í—˜/ì¸ìƒ ì¤‘ì‹¬, ì¸ê³¼ í•„ì—°ì„± íšŒì˜  
   - ë°ì¹´ë¥´íŠ¸: ì´ì„±/ëª…ì„íŒëª…í•œ ì¸ì‹ ì¤‘ì‹¬  
2. ê° ì‚¬ìƒê°€ì— ëŒ€í•´ â€œâ—‹â—‹ëŠ” ì§„ë¦¬ë¥¼ ë¬´ì—‡ìœ¼ë¡œ ë³´ë‚˜?â€ í•œ ì¤„ ìš”ì•½ì„ ì ê²Œ í•˜ê³ , ëª¨ë“  ì„ ì§€ëŠ” ê·¸ í•œ ì¤„ê³¼ ë¹„êµí•´ì„œ íŒë‹¨í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ì¸ë¬¸/ì² í•™(ì¸ìƒ/ê´€ë… ê°œë… ì¶”ë¡ )": """### ğŸ§  ì¸ë¬¸/ì² í•™: ì¸ìƒÂ·ê´€ë… ê°œë… ì´í•´
**1. ì§„ë‹¨**  
â€˜ì¸ìƒâ€™ê³¼ â€˜ê´€ë…â€™ì˜ ì •ì˜ë¥¼ ì½ì—ˆì§€ë§Œ, êµ¬ì²´ì ì¸ ì˜ˆì‹œì— ëŒ€ì…í•´ ë³´ì§€ ì•Šì•„ **ì–´ë–¤ ê²ƒì´ ì¸ìƒì´ê³  ì–´ë–¤ ê²ƒì´ ê´€ë…ì¸ì§€** êµ¬ë¶„í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ìˆ˜ì—… ì‹œê°„ì— ì§ì ‘ ì˜ˆì‹œë¥¼ ë§Œë“¤ê²Œ í•˜ì„¸ìš”.  
   - ì¸ìƒ: ì§€ê¸ˆ ë§‰ ë¶ˆì„ ë³¸ ê°•ë ¬í•œ ê²½í—˜  
   - ê´€ë…: ë‚˜ì¤‘ì— ë– ì˜¬ë¦¬ëŠ” â€˜ë¶ˆâ€™ì— ëŒ€í•œ ìƒê°  
2. ì§€ë¬¸ ì† ì˜ˆë“¤ì„ ë³´ê³ , ì¸ìƒ/ê´€ë… ì˜†ì— ê°ê° I, C ê°™ì€ ì•½ì–´ í‘œì‹œë¥¼ í•˜ê²Œ í•˜ì—¬ ê°œë…ê³¼ ì‚¬ë¡€ë¥¼ ê³„ì† ë¬¶ë„ë¡ ì§€ë„í•˜ì„¸ìš”.  
3. í•™ìƒì´ ìì‹ ì˜ ë§ë¡œ â€œì¸ìƒ = â—‹â—‹, ê´€ë… = â—‹â—‹â€ë¥¼ ì„¤ëª…í•˜ê²Œ í•´ ë³´ê³ , ë§ë¡œ ì„¤ëª…ì´ ì•ˆ ë˜ë©´ ê°œë… ì¬í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.""",

    "ë¹„ë¬¸í•™-ì¸ë¬¸/ì² í•™(ë³´ê¸° ì ìš©-ê²½í—˜ë¡  ì‚¬ë¡€ ë¶„ì„)": """### ğŸ§  ì¸ë¬¸/ì² í•™: ë³´ê¸° ì ìš©(ê²½í—˜ë¡  ì‚¬ë¡€)
**1. ì§„ë‹¨**  
[ë³´ê¸°]ì— ë‚˜ì˜¨ ì¼ìƒ ì‚¬ë¡€ë¥¼ ì§€ë¬¸ì—ì„œ ì„¤ëª…í•œ **ê²½í—˜ë¡  ê°œë…**ìœ¼ë¡œ ë²ˆì—­í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì§€ë¬¸ê³¼ ë³´ê¸°ì˜ ì—°ê²° ê³ ë¦¬ë¥¼ ì°¾ì§€ ëª»í•œ ìƒíƒœì…ë‹ˆë‹¤.

**2. Action Plan**  
1. [ë³´ê¸°]ë¥¼ ë³¼ ë•Œ, ë¬¸ì¥ ì˜†ì— â€œ= ì§€ë¬¸ì˜ â—‹â—‹â€ì²˜ëŸ¼ ì–´ë–¤ ê°œë…ì— í•´ë‹¹í•˜ëŠ”ì§€ ì§ì ‘ ì ê²Œ í•˜ì„¸ìš”. (ì˜ˆ: â€˜ìŠµê´€ì ì¸ ë¯¿ìŒâ€™ = í„ì˜ ì¸ê³¼ê´€ê³„ ì´í•´ ë°©ì‹)  
2. ì§€ë¬¸ ìš©ì–´ â†” ì¼ìƒ ì‚¬ë¡€ë¥¼ 1:1ë¡œ ì§ì§“ëŠ” í‘œë¥¼ ë§Œë“¤ì–´ ë³´ê²Œ í•˜ê³ , í‘œë¥¼ ì™„ì„±í•œ ë’¤ì— ì„ ì§€ë¥¼ ê²€í† í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.  
3. ë³´ê¸° ì ìš© ë¬¸ì œëŠ” â€˜ì§€ë¬¸ ìš”ì•½ ì—†ì´ ë³´ê¸°ë¶€í„° ì½ëŠ” ê²ƒâ€™ì„ ê¸ˆì§€ì‹œí‚¤ê³ , ë°˜ë“œì‹œ **ì§€ë¬¸ ê°œë… â†’ ë³´ê¸° ì‚¬ë¡€ ìˆœì„œ**ë¡œ ì½ê²Œ í•˜ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ì¸ë¬¸/ì² í•™(ì£¼ì¥Â·íƒ€ë‹¹ì„± í‰ê°€)": """### ğŸ§  ì¸ë¬¸/ì² í•™: ì£¼ì¥Â·íƒ€ë‹¹ì„± í‰ê°€
**1. ì§„ë‹¨**  
ê¸€ì“´ì´ì˜ ì£¼ì¥ì„ íŒŒì•…í–ˆì§€ë§Œ, ê·¸ ì£¼ì¥ì´ ì„±ë¦½í•˜ê¸° ìœ„í•œ **ì „ì œì™€ ì¡°ê±´**ì„ ì¶©ë¶„íˆ ìƒê°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë°˜ë¡€ê°€ ë˜ëŠ” ì‚¬ë¡€ë‚˜ ì¡°ê±´ ëˆ„ë½ì„ ë°œê²¬í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

**2. Action Plan**  
1. ì£¼ì¥ ë¬¸ì¥(ê²°ë¡ )ì„ ì°¾ì€ ë’¤, â€œì´ê²Œ ì„±ë¦½í•˜ë ¤ë©´ ë¬´ì—‡ì´ ì‚¬ì‹¤ì´ì–´ì•¼ í•˜ì§€?â€ë¥¼ ì„¸ ê°€ì§€ ì´ìƒ ë– ì˜¬ë¦¬ê²Œ í•˜ì„¸ìš”.  
2. ì§€ë¬¸ì´ë‚˜ ì„ ì§€ì— ë“±ì¥í•˜ëŠ” ì‚¬ë¡€ê°€ ê·¸ ì „ì œë¥¼ ê¹¨ëŠ”ì§€, ì•„ë‹ˆë©´ ì˜¤íˆë ¤ ê°•í™”í•˜ëŠ”ì§€ êµ¬ë¶„í•˜ê²Œ ì§€ë„í•˜ì„¸ìš”.  
3. â€œì „ì œë¥¼ ê±´ë“œë¦¬ëŠ” ì„ ì§€â€ê°€ ìˆëŠ”ì§€ë¥¼ ë¨¼ì € í™•ì¸í•˜ê²Œ í•˜ë©´, ê³ ë‚œë„ íƒ€ë‹¹ì„± í‰ê°€ ë¬¸ì œì—ì„œ ì‹¤ìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.""",

    "ë¬¸í•™-ìš´ë¬¸(ì„œì •ì‹œ ì „í†µ-í˜•ì‹Â·ë‚´ìš© ê°œê´€)": """### ğŸŒ™ ë¬¸í•™(ìš´ë¬¸): ì„œì •ì‹œ ì „í†µ ì´í•´
**1. ì§„ë‹¨**  
ì‹œì˜ í˜•ì‹(ìš´ìœ¨, í–‰ êµ¬ë¶„ ë“±)ì€ ë³´ì•˜ì§€ë§Œ, **í•œêµ­ ì„œì •ì‹œ ì „í†µ ì†ì—ì„œ ì´ ì‘í’ˆì´ ì–´ë–¤ ê³„ì—´ì— ì†í•˜ëŠ”ì§€**ë¥¼ ì •ë¦¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. ì‘í’ˆì„ ì½ì€ ë’¤, ë¨¼ì € â€œì´ ì‹œëŠ” â€˜ìì—° ì˜ˆì°¬ / í˜„ì‹¤ ë¹„íŒ / ë¯¼ì¡± ì •ì„œ / ì‚¬ë‘Â·ì´ë³„â€™ ì¤‘ ì–´ë””ì— ê°€ê¹Œìš´ê°€?â€ë¥¼ ë¶„ë¥˜í•˜ê²Œ í•˜ì„¸ìš”.  
2. í˜•ì‹ì  íŠ¹ì§•(ìŒë³´, ë°˜ë³µ, ì¢…ê²° ì–´ë¯¸, ì‹œì  í™”ìì˜ íƒœë„)ì„ ë‚˜ì—´í•˜ê³ , ê·¸ê²ƒì´ ë‚´ìš©ê³¼ ì–´ë–»ê²Œ ì—°ê²°ë˜ëŠ”ì§€ í•œ ì¤„ë¡œ ì„¤ëª…í•˜ê²Œ í›ˆë ¨ì‹œí‚¤ì„¸ìš”.  
3. ë¹„ìŠ·í•œ ì „í†µì˜ ì‹œ ë‘ í¸ì„ ë‚˜ë€íˆ ë†“ê³  ê³µí†µì Â·ì°¨ì´ì ì„ ë¹„êµí•˜ëŠ” í™œë™ì„ í†µí•´ â€˜ì„œì •ì‹œ ì „í†µâ€™ì´ë¼ëŠ” í° í‹€ì„ ì¡ê²Œ í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.""",

    "ë¬¸í•™-ìš´ë¬¸(ê³ ì „ì‹œê°€-ìƒí™©Â·ì •ì„œ íŒŒì•…)": """### ğŸŒ™ ë¬¸í•™(ìš´ë¬¸): ê³ ì „ì‹œê°€ ìƒí™©Â·ì •ì„œ
**1. ì§„ë‹¨**  
ê³ ì „ ì–´íœ˜ì™€ ì–´ìˆœì— ë§‰í˜€, í™”ìê°€ ì²˜í•œ **ìƒí™©ê³¼ ì •ì„œ**ë¥¼ í˜„ì¬ì–´ë¡œ ë²ˆì—­í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì‹œì–´ì˜ ì˜ë¯¸ì™€ ì •ì„œì˜ ë°©í–¥ì„ ì˜ëª» íŒŒì•…í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ë¨¼ì € ê° í–‰ì„ ì˜¤ëŠ˜ë‚  ë§ë¡œ ì˜®ê²¨ ì ê²Œ í•˜ì„¸ìš”. (ë„ˆë¬´ ì˜ˆì˜ê²Œ ë²ˆì—­í•˜ë ¤ í•˜ì§€ ë§ê³ , ë§í•˜ë“¯ì´ ì“°ê²Œ)  
2. ê·¸ë‹¤ìŒ â€œí™”ìê°€ ì§€ê¸ˆ ì–´ë””ì—ì„œ, ëˆ„êµ¬ë¥¼ ë– ì˜¬ë¦¬ë©°, ë¬´ì—‡ì„ ë°”ë¼ëŠ”ì§€â€ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ê²Œ í•˜ì„¸ìš”.  
3. ì •ì„œë¥¼ ë³¼ ë•ŒëŠ” ê°œë³„ ë‹¨ì–´ì— ë§¤ë‹¬ë¦¬ê¸°ë³´ë‹¤ â€˜í™”ìâ€“ë‹˜â€“ìì—°â€“í˜„ì‹¤â€™ ì‚¬ì´ì˜ ê´€ê³„(ê°€ê¹Œì›Œì§€ëŠ”ê°€/ë©€ì–´ì§€ëŠ”ê°€, ê¸ì •/ë¶€ì •)ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë³´ê²Œ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¬¸í•™-ìš´ë¬¸(í˜„ëŒ€ì‹œ-ì´ë¯¸ì§€Â·ì •ì„œ í•´ì„)": """### ğŸŒ™ ë¬¸í•™(ìš´ë¬¸): í˜„ëŒ€ì‹œ ì´ë¯¸ì§€Â·ì •ì„œ
**1. ì§„ë‹¨**  
ì‹œì–´ë¥¼ **ì‚¬ì „ì  ì˜ë¯¸**ë¡œë§Œ í•´ì„í•˜ê³ , ê·¸ ì´ë¯¸ì§€ê°€ ë§Œë“¤ì–´ ë‚´ëŠ” ë¶„ìœ„ê¸°Â·ì •ì„œê¹Œì§€ ì—°ê²°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. â€˜ê¸¸â€™, â€˜ë°”ë‹¤â€™, â€˜ì–´ë‘ â€™ ê°™ì€ ìƒì§•ì  ì‹œì–´ê°€ ë¬¸ì ê·¸ëŒ€ë¡œë§Œ ì½í˜”ì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. í•™ìƒì—ê²Œ â€œì´ ì‹œì–´ë¥¼ í’ê²½Â·ìƒíƒœÂ·ê´€ê³„ ì¤‘ ì–´ë–¤ ê²ƒìœ¼ë¡œ ë³´ë©´ ìì—°ìŠ¤ëŸ¬ìš´ê°€?â€ë¥¼ ë¬»ê²Œ í•˜ì„¸ìš”. (ì˜ˆ: â€˜ê¸¸â€™ = ì‚¶ì˜ ë°©í–¥, ë°©í™©)  
2. ì‹œì˜ ì´ë¯¸ì§€ë¥¼ ê¸ì •/ë¶€ì •, ë°ìŒ/ì–´ë‘ , ì •ì§€/ì›€ì§ì„ ë“± **ëŒ€ë¹„ ì¶•**ì—ì„œ ë¶„ë¥˜í•˜ê²Œ í•˜ì—¬, ì „ì²´ ì •ì„œ íë¦„ì„ ì‹œê°ì ìœ¼ë¡œ ì •ë¦¬í•˜ê²Œ í•©ë‹ˆë‹¤.  
3. ë§ˆì§€ë§‰ì—ëŠ” â€œì‹œ ì „ì²´ì—ì„œ í™”ìê°€ ëŠë¼ëŠ” í•µì‹¬ ê°ì • í•œ ë‹¨ì–´â€ë¥¼ ë½‘ê²Œ í•˜ê³ , ê·¼ê±°ê°€ ë˜ëŠ” ì‹œì–´ ì„¸ ê°œë¥¼ í•¨ê»˜ ì œì‹œí•˜ê²Œ í•˜ì„¸ìš”.""",

    "ë¬¸í•™-ìš´ë¬¸(ì „í†µ ê³„ìŠ¹Â·ë³€ìš© ë°©ì‹ í‰ê°€)": """### ğŸŒ™ ë¬¸í•™(ìš´ë¬¸): ì „í†µ ê³„ìŠ¹Â·ë³€ìš©
**1. ì§„ë‹¨**  
ê³ ì „ì‹œê°€ì˜ ì „í†µ ìš”ì†Œì™€ í˜„ëŒ€ì‹œì˜ ë³€ìš© ìš”ì†Œë¥¼ ë¶„ë¦¬í•´ì„œ ë³´ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ â€˜ê³„ìŠ¹â€™ê³¼ â€˜íŒŒê²©â€™ì´ ë’¤ì„ì¸ ì„ ì§€ë¥¼ êµ¬ë¶„í•˜ëŠ” ë° ì–´ë ¤ì›€ì„ ê²ªì—ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ê³ ì „ ì‘í’ˆê³¼ì˜ ê³µí†µì /ì°¨ì´ì ì„ ê°ê° í•œ ì¤„ì”© ì“°ê²Œ í•˜ì„¸ìš”. (ì˜ˆ: ìì—° ì†Œì¬ ì‚¬ìš©ì€ ê³„ìŠ¹, í™”ìì˜ íƒœë„ëŠ” ë³€ìš©)  
2. í˜•ì‹(ìš´ìœ¨, ë°˜ë³µ êµ¬ì¡°)ê³¼ ë‚´ìš©(ì •ì„œ, ì£¼ì œ)ì´ ê°ê° ì–´ë–»ê²Œ ì „í†µì„ ì´ì–´ë°›ì•˜ëŠ”ì§€/ë’¤í‹€ì—ˆëŠ”ì§€ í‘œë¡œ ì •ë¦¬í•˜ê²Œ í•©ë‹ˆë‹¤.  
3. ì„ ì§€ë¥¼ ë³¼ ë•Œ â€œì´ê±´ â€˜ê³„ìŠ¹â€™ì— ì´ˆì ì¸ê°€, â€˜ë³€ìš©â€™ì— ì´ˆì ì¸ê°€?â€ë¥¼ ë¨¼ì € êµ¬ë¶„í•˜ê³  ì½ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¬¸í•™-ìš´ë¬¸(ë³´ê¸° ì ìš©-ì¢…í•© ê°ìƒ)": """### ğŸŒ™ ë¬¸í•™(ìš´ë¬¸): ë³´ê¸° ì ìš©Â·ì¢…í•© ê°ìƒ
**1. ì§„ë‹¨**  
[ë³´ê¸°]ì˜ ê°ìƒ ë¬¸ì¥ì„ ì§€ë¬¸ì˜ ê·¼ê±°ì™€ ì—°ê²°í•˜ì§€ ì•Šê³ , ìì‹ ì˜ ëŠë‚Œì— ê°€ê¹Œìš´ ì„ ì§€ë¥¼ ê³ ë¥¸ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ê·¼ê±° ì—†ëŠ” ê°ìƒì€ ì •ë‹µì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. [ë³´ê¸°]ì˜ ê° ë¬¸ì¥ë§ˆë‹¤ ì‹œ ì†ì—ì„œì˜ **ê·¼ê±° ì‹œì–´**ë¥¼ ì°¾ê²Œ í•˜ì„¸ìš”. (ì—†ë‹¤ë©´ ê·¸ ê°ìƒì€ ì˜¤ë‹µ ê°€ëŠ¥ì„±ì´ í¼)  
2. â€œì´ ê°ìƒì´ ë§ìœ¼ë ¤ë©´, ì‹œ ì†ì—ì„œ ì–´ë–¤ í‘œí˜„ì´ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•˜ì§€?â€ë¥¼ ì§ˆë¬¸í•´ ë³´ê²Œ í•©ë‹ˆë‹¤.  
3. ë³´ê¸° ê°ìƒê³¼ ì‹œ ë‚´ìš©ì„ ë¹„êµí•  ë•Œ, ê°ì • ë‹¨ì–´ë§Œ ë³´ì§€ ë§ê³  **ê´€ê³„Â·ìƒí™©Â·íƒœë„**ê¹Œì§€ í•¨ê»˜ í™•ì¸í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ì‚¬íšŒ/ê²½ì œ(ì¡°ì„¸-íš¨ìœ¨ì„±Â·ê³µí‰ì„± ê°œë…)": """### ğŸ“ˆ ì‚¬íšŒ/ê²½ì œ: ì¡°ì„¸Â·íš¨ìœ¨ì„±Â·ê³µí‰ì„± ê°œë…
**1. ì§„ë‹¨**  
ì¡°ì„¸ ì •ì±…ì„ ì„¤ëª…í•˜ëŠ” ë¬¸ë‹¨ì—ì„œ **íš¨ìœ¨ì„±ê³¼ ê³µí‰ì„±ì˜ ê°œë…**ì€ ëŒ€ëµ ì´í•´í–ˆìœ¼ë‚˜, ë‘˜ì´ ì–´ë–¤ ìƒí™©ì—ì„œ ì¶©ëŒí•˜ëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ë– ì˜¬ë¦¬ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. íš¨ìœ¨ì„± = ì „ì²´ íŒŒì´ í‚¤ìš°ê¸°, ê³µí‰ì„± = íŒŒì´ ë‚˜ëˆ„ëŠ” ë°©ì‹ì´ë¼ëŠ” ë¹„ìœ ë¡œ ë‹¤ì‹œ ì •ë¦¬í•˜ê²Œ í•˜ì„¸ìš”.  
2. ì‹¤ì œ ì‚¬ë¡€(ëˆ„ì§„ì„¸, ë³µì§€ ì •ì±… ë“±)ë¥¼ ê°€ì§€ê³  â€œì´ê±´ íš¨ìœ¨ì„±/ê³µí‰ì„± ì¤‘ ì–´ëŠ ìª½ì„ ë” ì¤‘ì‹œí•œ ì •ì±…ì¸ê°€?â€ë¥¼ ë¶„ë¥˜í•´ ë³´ê²Œ í•©ë‹ˆë‹¤.  
3. ë¬¸ì œë¥¼ í’€ ë•ŒëŠ” ë¬¸ì¥ ì˜†ì— `íš¨ìœ¨â†‘ ê³µí‰â†“` ê°™ì€ í™”ì‚´í‘œ ë©”ëª¨ë¥¼ í•˜ê²Œ í•´ì„œ, ë°©í–¥ì„±ì„ ì‹œê°ì ìœ¼ë¡œ ìµíˆë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ì‚¬íšŒ/ê²½ì œ(íš¨ìœ¨ì„± vs ê³µí‰ì„± ë¹„êµ)": """### ğŸ“ˆ ì‚¬íšŒ/ê²½ì œ: íš¨ìœ¨ì„± vs ê³µí‰ì„± ë¹„êµ
**1. ì§„ë‹¨**  
ë‘ ê°€ì¹˜ê°€ ì„œë¡œ ì¶©ëŒí•  ë•Œ ì–´ë–¤ ì„ íƒì„ í•˜ëŠ”ì§€, ê·¸ì— ë”°ë¥¸ ì¥ë‹¨ì ì„ ë…¼ë¦¬ì ìœ¼ë¡œ ë¹„êµí•˜ëŠ” ë° ì–´ë ¤ì›€ì´ ìˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. â€œíš¨ìœ¨ì„±ë§Œ ë†’ì´ë©´ ìƒê¸¸ ìˆ˜ ìˆëŠ” ë¬¸ì œ / ê³µí‰ì„±ë§Œ ì¤‘ì‹œí•˜ë©´ ìƒê¸¸ ìˆ˜ ìˆëŠ” ë¬¸ì œâ€ë¥¼ ê°ê° ë‘ ê°€ì§€ì”© ì¨ ë³´ê²Œ í•˜ì„¸ìš”.  
2. ì§€ë¬¸ì—ì„œ ì œì‹œí•œ ì…ì¥ì´ ì–´ëŠ ìª½ì— ë” ì¹˜ìš°ì³ ìˆëŠ”ì§€, ê·¼ê±° ë¬¸ì¥ì„ í‘œì‹œí•˜ê²Œ í•©ë‹ˆë‹¤.  
3. ì„ ì§€ë¥¼ ì½ì„ ë•Œ, ë‘ ê°€ì¹˜ë¥¼ ëª¨ë‘ ë§Œì¡±ì‹œí‚¤ëŠ”ì§€ë³´ë‹¤ **ì–´ëŠ ê°€ì¹˜ë¥¼ ë” ìš°ì„ ì‹œí•˜ëŠ”ì§€**ì— ì´ˆì ì„ ë§ì¶”ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ì‚¬íšŒ/ê²½ì œ(ë³´ê¸° ì ìš©-ì¡°ì„¸ ì‚¬ë¡€ ë¶„ì„)": """### ğŸ“ˆ ì‚¬íšŒ/ê²½ì œ: ë³´ê¸° ì ìš©(ì¡°ì„¸ ì‚¬ë¡€)
**1. ì§„ë‹¨**  
[ë³´ê¸°]ì— ì œì‹œëœ êµ¬ì²´ì ì¸ ì„¸ê¸ˆ ì‚¬ë¡€ë¥¼, ì§€ë¬¸ì—ì„œ ì„¤ëª…í•œ ì¡°ì„¸ ì›ë¦¬(íš¨ìœ¨ì„±/ê³µí‰ì„±, ì¡°ì„¸ í˜•í‰ ë“±)ì™€ ì—°ê²°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. ë³´ê¸° ì† ì‚¬ë¡€ ì˜†ì— â€œ= íš¨ìœ¨ì„± ì¤‘ì‹œ / ê³µí‰ì„± ì¤‘ì‹œ / í˜¼í•©â€ì²˜ëŸ¼ ì§€ë¬¸ ê°œë…ì„ ë¶™ì´ê²Œ í•˜ì„¸ìš”.  
2. ì„¸ìœ¨ êµ¬ì¡°Â·ê³¼ì„¸ ëŒ€ìƒÂ·ì¬ì› ì‚¬ìš©ì²˜ê°€ ê°ê° íš¨ìœ¨ì„±Â·ê³µí‰ì„±ê³¼ ì–´ë–»ê²Œ ì—°ê²°ë˜ëŠ”ì§€ ì§ˆë¬¸í•˜ë©° í•˜ë‚˜ì”© ë”°ì ¸ ë³´ê²Œ í•©ë‹ˆë‹¤.  
3. ë³´ê¸° ì ìš© ë¬¸ì œëŠ” ë°˜ë“œì‹œ **ì§€ë¬¸ ê°œë… ìš”ì•½ â†’ ë³´ê¸° ì‚¬ë¡€ ì½ê¸° â†’ ê°œë… ë¼ë²¨ ë¶™ì´ê¸°** ìˆœì„œë¥¼ ì§€í‚¤ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë§¤ì²´-ì˜í™”/ì‹œë‚˜ë¦¬ì˜¤(ì¥ë©´ ì—°ì¶œ ì˜ë„ íŒŒì•…)": """### ğŸ¬ ë§¤ì²´: ì˜í™”/ì‹œë‚˜ë¦¬ì˜¤ ì¥ë©´ ì—°ì¶œ ì˜ë„
**1. ì§„ë‹¨**  
ì¥ë©´ ì „í™˜, ì¹´ë©”ë¼ ê±°ë¦¬, ë°°ê²½ìŒì•… ë“± ì—°ì¶œ ìš”ì†Œë¥¼ ê·¸ëƒ¥ â€˜ìƒí™© ì„¤ëª…â€™ ì •ë„ë¡œë§Œ ì´í•´í•˜ê³ , **ê´€ê°ì—ê²Œ ì£¼ëŠ” íš¨ê³¼**ê¹Œì§€ ì—°ê²°í•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ì»· ì „í™˜, í´ë¡œì¦ˆì—…, ë¡±ìˆ, ë°°ê²½ìŒ ë“± ì—°ì¶œ ì¥ì¹˜ ì˜†ì— `ê¸´ì¥ ê°•í™”`, `ê°ì • ì§‘ì¤‘`, `ì •ë³´ ì œê³µ` ê°™ì€ íš¨ê³¼ë¥¼ ì ê²Œ í•˜ì„¸ìš”.  
2. ê°™ì€ ë‚´ìš©ì´ë¼ë„ ì–´ë–»ê²Œ ì°ëŠëƒì— ë”°ë¼ ê´€ê° ì¸ìƒì´ ë‹¬ë¼ì§„ë‹¤ëŠ” ì ì„ ì§§ì€ ì˜ìƒ ì˜ˆì‹œë¡œ ê²½í—˜í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.  
3. ë¬¸ì œì—ì„œ ë¬»ëŠ” ê²ƒì´ â€˜ë‚´ìš©â€™ì¸ì§€ â€˜ì—°ì¶œ íš¨ê³¼â€™ì¸ì§€ ë¨¼ì € êµ¬ë¶„í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë§¤ì²´-ì˜í™”/ì‹œë‚˜ë¦¬ì˜¤(ë³´ê¸° ì ìš©-ê°ìƒ ê´€ì )": """### ğŸ¬ ë§¤ì²´: ì˜í™” ê°ìƒ ê´€ì (ë³´ê¸° ì ìš©)
**1. ì§„ë‹¨**  
[ë³´ê¸°]ì˜ ê°ìƒë¬¸ì´ ì‚¬ìš©í•˜ëŠ” ê´€ì (ì¸ë¬¼ ì¤‘ì‹¬, ì£¼ì œ ì¤‘ì‹¬, ì—°ì¶œ ì¤‘ì‹¬ ë“±)ì„ êµ¬ë¶„í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ê°ìƒ ê´€ì ê³¼ ë§ì§€ ì•ŠëŠ” ë‚´ìš©ì„ ê±¸ëŸ¬ë‚´ì§€ ëª»í•©ë‹ˆë‹¤.

**2. Action Plan**  
1. ë³´ê¸° ê°ìƒë¬¸ì—ì„œ ë°˜ë³µë˜ëŠ” ë‹¨ì–´ë‚˜ ê°•ì¡°ë˜ëŠ” ë¶€ë¶„ì„ ì°¾ì•„ â€œì´ ê°ìƒì€ **ì¸ë¬¼/ì£¼ì œ/ì—°ì¶œ/ì‚¬íšŒì  ì˜ë¯¸** ì¤‘ ì–´ë””ì— ì´ˆì ì´ ìˆëŠ”ê°€?â€ë¥¼ ë¶„ë¥˜í•˜ê²Œ í•˜ì„¸ìš”.  
2. ê° ê´€ì ë³„ë¡œ ì–´ë–¤ ìš”ì†Œë¥¼ ì¤‘ì ì ìœ¼ë¡œ ì–¸ê¸‰í•˜ëŠ”ì§€(ì¸ë¬¼ ë‚´ë©´, ìƒì§•, ì¹´ë©”ë¼ ì›€ì§ì„ ë“±) ê°„ë‹¨í•œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ ë‘ê³ , ê·¸ ê¸°ì¤€ìœ¼ë¡œ ì„ ì§€ë¥¼ íŒë‹¨í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë§¤ì²´-ì˜í™”/ì‹œë‚˜ë¦¬ì˜¤(êµ¬ì„±Â·ì¥ë©´ ë°°ì—´ íš¨ê³¼)": """### ğŸ¬ ë§¤ì²´: êµ¬ì„±Â·ì¥ë©´ ë°°ì—´ íš¨ê³¼
**1. ì§„ë‹¨**  
ì‚¬ê±´ì´ ì œì‹œë˜ëŠ” ìˆœì„œë¥¼ ë°”ê¾¸ì—ˆì„ ë•Œ **ê¸´ì¥ê°Â·ì •ë³´ ê³µê°œ ì‹œì **ì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§€ëŠ”ì§€ ìƒìƒí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. ì œì‹œëœ ì¥ë©´ ìˆœì„œë¥¼ ë°”ê¾¸ì–´ ë‹¤ì‹œ ë°°ì—´í•´ ë³´ê²Œ í•˜ê³ , â€œì´ë ‡ê²Œ ë°”ê¾¸ë©´ ê´€ê°ì€ ì–´ë–¤ ì •ë³´ë¥¼ ì–¸ì œ ì•Œê²Œ ë˜ëŠ”ê°€?â€ë¥¼ ë¹„êµí•˜ê²Œ í•˜ì„¸ìš”.  
2. í”Œë˜ì‹œë°±, ë¯¸ë¦¬ ì œì‹œëœ ê²°ë§ ì¥ë©´ ë“± ë¹„ì„ í˜• êµ¬ì„±ì´ ì‘í’ˆ í•´ì„ì— ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ í† ë¡ í•´ ë³´ê²Œ í•˜ë©´ íš¨ê³¼ì ì…ë‹ˆë‹¤.  
3. ë¬¸ì œì—ì„œ â€˜êµ¬ì„±ìƒ íš¨ê³¼â€™ë¥¼ ë¬»ëŠ” ì„ ì§€ëŠ” í•­ìƒ **ì •ë³´ ê³µê°œ ì‹œì Â·ê¸´ì¥ê°Â·ì¸ë¬¼ì— ëŒ€í•œ ì¸ìƒ ë³€í™”** ì¤‘ ì–´ë””ë¥¼ ë§í•˜ëŠ”ì§€ í™•ì¸í•˜ê²Œ í•˜ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ê³¼í•™/ê¸°ìˆ (ì´ˆê³ ì¸µ ê±´ë¬¼-í•˜ì¤‘ ê°œë… ì´í•´)": """### âš™ï¸ ê³¼í•™/ê¸°ìˆ : ì´ˆê³ ì¸µ ê±´ë¬¼Â·í•˜ì¤‘ ê°œë…
**1. ì§„ë‹¨**  
í•˜ì¤‘ì˜ ì¢…ë¥˜(ê³ ì • í•˜ì¤‘/í™œë™ í•˜ì¤‘/í’í•˜ì¤‘ ë“±)ë¥¼ êµ¬ë¶„í•˜ì§€ ëª»í•˜ê±°ë‚˜, êµ¬ì¡°ë¬¼ì— ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì‘ìš©í•˜ëŠ”ì§€ ìƒìƒí•˜ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ì§€ë¬¸ì— ë‚˜ì˜¨ í•˜ì¤‘ ì¢…ë¥˜ ì˜†ì— ê°„ë‹¨í•œ ì˜ˆì‹œ(ì‚¬ëŒÂ·ê°€êµ¬Â·ë°”ëŒ ë“±)ë¥¼ ì§ì ‘ ê·¸ë ¤ ë³´ê²Œ í•˜ì„¸ìš”.  
2. â€œì–´ë–¤ í•˜ì¤‘ì€ í•­ìƒ ì¡´ì¬í•˜ê³ , ì–´ë–¤ í•˜ì¤‘ì€ ì‹œê°„ì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ”ê°€?â€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¥˜í•˜ê²Œ í•©ë‹ˆë‹¤.  
3. ì„ ì§€ì—ì„œ í•˜ì¤‘ì˜ ë°©í–¥(ìˆ˜ì§/ìˆ˜í‰)ê³¼ ì§€ì†ì„±(í•­ìƒ/ì¼ì‹œì )ì„ ë°”ê¾¸ì–´ ë§í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ê³¼í•™/ê¸°ìˆ (êµ¬ì¡° ìœ í˜• ë¹„êµÂ·ì„¤ëª… ë°©ì‹)": """### âš™ï¸ ê³¼í•™/ê¸°ìˆ : êµ¬ì¡° ìœ í˜• ë¹„êµ
**1. ì§„ë‹¨**  
ì—¬ëŸ¬ êµ¬ì¡° ìœ í˜•(ì˜ˆ: ë¼ë©˜, íŠ¸ëŸ¬ìŠ¤ ë“±)ì˜ íŠ¹ì§•ì„ ì•”ê¸° ìˆ˜ì¤€ìœ¼ë¡œë§Œ ì•Œê³ , **ì–´ë–¤ êµ¬ì¡°ê°€ ì–´ë–¤ í•˜ì¤‘ì— ì í•©í•œì§€** ì—°ê²°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. êµ¬ì¡°ë³„ë¡œ â€œì–´ë–¤ ë°©í–¥ì˜ í˜ì— ê°•í•œì§€, ì£¼ë¡œ ì–´ë””ì— ì“°ì´ëŠ”ì§€â€ë¥¼ ì§§ê²Œ ì •ë¦¬í•œ í‘œë¥¼ ë§Œë“¤ê²Œ í•˜ì„¸ìš”.  
2. ì§€ë¬¸ ì„¤ëª…ì—ì„œ â€˜ë¹„êµ/ëŒ€ì¡°â€™ í‘œí˜„(ë°˜ë©´ì—, ê·¸ëŸ¬ë‚˜, ~ì™€ ë‹¬ë¦¬)ì„ í‘œì‹œí•˜ê²Œ í•˜ì—¬, êµ¬ì¡° ê°„ ì°¨ì´ì ì„ ëˆˆì— ë„ê²Œ í•©ë‹ˆë‹¤.  
3. ë³´ê¸°ë‚˜ ì„ ì§€ì— ì œì‹œëœ ìƒí™©(ë°”ëŒì´ ê°•í•œ ì§€ì—­, ì§€ì§„ ê°€ëŠ¥ì„± ë“±)ì— ì–´ë–¤ êµ¬ì¡°ê°€ ì í•©í•œì§€ ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•´ ë³´ê²Œ í•˜ëŠ” ì—°ìŠµì„ ì‹œí‚¤ì„¸ìš”.""",

    "ë¹„ë¬¸í•™-ê³¼í•™/ê¸°ìˆ (TLCD ì‘ë™ ì›ë¦¬ ì´í•´)": """### âš™ï¸ ê³¼í•™/ê¸°ìˆ : TLCD ì‘ë™ ì›ë¦¬
**1. ì§„ë‹¨**  
TLCDì˜ êµ¬ì¡°ì™€ ì‘ë™ ì›ë¦¬ë¥¼ ê¸€ë¡œë§Œ ì½ê³ , **â€˜í”ë“¤ë¦¼ â†’ ì•¡ì²´ ì›€ì§ì„ â†’ í˜ ìƒì‡„â€™**ë¼ëŠ” ê³¼ì •ì„ ë‹¨ê³„ì ìœ¼ë¡œ ì •ë¦¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. TLCDì˜ êµ¬ì¡°ë¥¼ ê°„ë‹¨íˆ ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë¦¬ê²Œ í•˜ê³ , ê±´ë¬¼ì´ í•œìª½ìœ¼ë¡œ ê¸°ìš¸ ë•Œ ì•¡ì²´ê°€ ì–´ë–»ê²Œ ì›€ì§ì—¬ ë°˜ëŒ€ í˜ì„ ë§Œë“œëŠ”ì§€ í™”ì‚´í‘œë¡œ í‘œì‹œí•˜ê²Œ í•˜ì„¸ìš”.  
2. ì›ì¸-ê²°ê³¼ë¥¼ `ê±´ë¬¼ í”ë“¤ë¦¼ â†‘ â†’ ì•¡ì²´ ìš´ë™ â†‘ â†’ ìƒì‡„ë ¥ â†‘`ì²˜ëŸ¼ í•œ ì¤„ ê³µì‹ìœ¼ë¡œ ì •ë¦¬í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”.  
3. ê³„ì‚°ì´ë‚˜ ìˆ˜ì¹˜ë³´ë‹¤, â€œì–´ë–¤ ìš”ì†Œê°€ ë³€í•  ë•Œ ì–´ë–¤ ê²°ê³¼ê°€ ë”°ë¼ì˜¤ëŠ”ì§€â€ì— ì´ˆì ì„ ë§ì¶° ì½ê²Œ í•´ì•¼ í•©ë‹ˆë‹¤.""",

    "ë¹„ë¬¸í•™-ê³¼í•™/ê¸°ìˆ (ë³´ê¸°-ë„ì‹ ì •ë³´ ì ìš©)": """### âš™ï¸ ê³¼í•™/ê¸°ìˆ : ë„ì‹ ì •ë³´ ì ìš©
**1. ì§„ë‹¨**  
[ë³´ê¸°]ì— ì œì‹œëœ ë„ì‹Â·ê·¸ë˜í”„Â·í‘œë¥¼ TLCD ì„¤ëª…ê³¼ ì •í™•íˆ ì—°ê²°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë„ì‹ì˜ ê° ìš”ì†Œê°€ ì§€ë¬¸ì—ì„œ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€ íŒŒì•…ì´ ë¶€ì¡±í•œ ìƒíƒœì…ë‹ˆë‹¤.

**2. Action Plan**  
1. ë„ì‹ì˜ ê° ë¶€ë¶„(ìƒì, í™”ì‚´í‘œ)ì— ì§€ë¬¸ ìš©ì–´ë¥¼ ì§ì ‘ ì ê²Œ í•˜ì—¬ 1:1ë¡œ ë§¤ì¹­ì‹œì¼œ ë³´ê²Œ í•˜ì„¸ìš”.  
2. ì§€ë¬¸ê³¼ ë„ì‹ ì¤‘ ë¬´ì—‡ì´ â€˜ì›ë¦¬ ì„¤ëª…â€™ì´ê³  ë¬´ì—‡ì´ â€˜êµ¬ì²´ì  ì˜ˆì‹œâ€™ì¸ì§€ ë‚˜ëˆ„ê²Œ í•©ë‹ˆë‹¤.  
3. ë„ì‹ ì„¤ëª… ë¬¸ì œëŠ” ì§€ë¬¸ ì „ì²´ë¥¼ ë‹¤ì‹œ ì½ê¸°ë³´ë‹¤, ë„ì‹-ì§€ë¬¸ ì‚¬ì´ì˜ ëŒ€ì‘ ê´€ê³„ë¥¼ ë¨¼ì € ì™„ì„±í•œ ë’¤ ì„ ì§€ë¥¼ ê²€í† í•˜ê²Œ í•˜ì„¸ìš”.""",

    "ë¬¸í•™-ê³ ì „ì†Œì„¤(ë°°ë¹„ì¥ì „-ì‘í’ˆÂ·ëª¨í‹°í”„ ê°œê´€)": """### ğŸ“– ë¬¸í•™(ê³ ì „ì†Œì„¤): ë°°ë¹„ì¥ì „ ê°œê´€
**1. ì§„ë‹¨**  
ë°°ë¹„ì¥ì „ì„ ë‹¨ìˆœí•œ ì˜›ë‚  ì´ì•¼ê¸°ë¡œë§Œ ë³´ê³ , **í’ìÂ·í•´í•™Â·ìœ„ì„  í­ë¡œ**ë¼ëŠ” í•µì‹¬ ëª¨í‹°í”„ë¥¼ ì¡ì§€ ëª»í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ë°°ë¹„ì¥ ì¸ë¬¼ì„ í•œ ì¤„ë¡œ ìš”ì•½í•˜ê²Œ í•˜ì„¸ìš”. (ì˜ˆ: ë°–ì—ì„œëŠ” ì—„ê²©í•œ ì„ ë¹„, ì†ìœ¼ë¡œëŠ” ìš•ë§ì— í”ë“¤ë¦¬ëŠ” ì¸ë¬¼)  
2. ì´ì•¼ê¸°ì˜ ì£¼ìš” ì‚¬ê±´ì„ â€œê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚œ ëª¨ìŠµ vs ì†ë§ˆìŒâ€ êµ¬ì¡°ë¡œ ë‚˜ëˆ  ì •ë¦¬í•˜ê²Œ í•©ë‹ˆë‹¤.  
3. ë‹¤ë¥¸ í’ì ì†Œì„¤(ì˜ˆ: í—ˆìƒì „ ë“±)ê³¼ ë¹„êµí•˜ì—¬, ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì¸ë¬¼ì˜ ìœ„ì„ ì„ ë“œëŸ¬ë‚´ëŠ”ì§€ ê³µí†µì Â·ì°¨ì´ì ì„ ì •ë¦¬í•˜ê²Œ í•˜ì„¸ìš”.""",

    "ë¬¸í•™-ê³ ì „ì†Œì„¤(ë°°ë¹„ì¥ì „-ì¸ë¬¼Â·ê°ˆë“± êµ¬ì¡°)": """### ğŸ“– ë¬¸í•™(ê³ ì „ì†Œì„¤): ë°°ë¹„ì¥ì „ ì¸ë¬¼Â·ê°ˆë“±
**1. ì§„ë‹¨**  
ì‚¬ê±´ ì „ê°œëŠ” ì´í•´í–ˆì§€ë§Œ, ì¸ë¬¼ë“¤ ì‚¬ì´ì˜ **ê°ˆë“± êµ¬ì¡°ì™€ í˜ì˜ ì—­ì „**ì„ ì¶©ë¶„íˆ íŒŒì•…í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆ ì£¼ì¸ê³µì˜ ì‹¬ë¦¬ ë³€í™”ì™€ ì£¼ë³€ ì¸ë¬¼ì˜ ì˜ë„ë¥¼ ë†“ì³¤ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. ë°°ë¹„ì¥, ê¸°ìƒ, ì•„ë‚´, ì£¼ë³€ ì¸ë¬¼ì˜ ê´€ê³„ë„ë¥¼ ê·¸ë¦¬ê³ , ê° ì¸ë¬¼ì´ ë°°ë¹„ì¥ì„ ì–´ë–»ê²Œ â€˜ì‹œí—˜â€™í•˜ê±°ë‚˜ â€˜ì¡°ë¡±â€™í•˜ëŠ”ì§€ í™”ì‚´í‘œë¡œ í‘œì‹œí•˜ê²Œ í•˜ì„¸ìš”.  
2. ê°ˆë“±ì´ ìµœê³ ì¡°ì— ì´ë¥´ëŠ” ì¥ë©´ê³¼, ê·¸ ê°ˆë“±ì´ ì–´ë–»ê²Œ í•´ì†Œë˜ëŠ”ì§€ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì ê²Œ í•©ë‹ˆë‹¤.  
3. ì„ ì§€ë¥¼ ì½ì„ ë•Œ ë‹¨ìˆœí•œ ì‚¬ê±´ ìš”ì•½ì¸ì§€, ì¸ë¬¼ì˜ ê°€ì¹˜ê´€Â·íƒœë„ë¥¼ ë“œëŸ¬ë‚´ëŠ”ì§€ êµ¬ë¶„í•´ì„œ ë³´ê²Œ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¬¸í•™-ê³ ì „ì†Œì„¤(ë°°ë¹„ì¥ì „-ì¥ë©´ë³„ íƒœë„ í•´ì„)": """### ğŸ“– ë¬¸í•™(ê³ ì „ì†Œì„¤): ì¥ë©´ë³„ íƒœë„ í•´ì„
**1. ì§„ë‹¨**  
ê° ì¥ë©´ì—ì„œ ë°°ë¹„ì¥ì´ ë³´ì´ëŠ” íƒœë„(ì²´ë©´/ìš•ë§/ë‘ë ¤ì›€ ë“±)ë¥¼ ìƒí™©ì— ë§ê²Œ ì½ì–´ë‚´ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í•œ ë²ˆ í˜•ì„±í•œ ì¸ë¬¼ ì´ë¯¸ì§€ë§Œ ê³ ìˆ˜í•œ ì±„, ì¥ë©´ë³„ ë³€í™”ë¥¼ ë†“ì¹œ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

**2. Action Plan**  
1. ì£¼ìš” ì¥ë©´ë§ˆë‹¤ â€œë°–ìœ¼ë¡œ ë“œëŸ¬ë‚œ ë§/í–‰ë™â€ê³¼ â€œì†ë§ˆìŒâ€ì„ ë”°ë¡œ ì ê²Œ í•˜ì—¬, ìœ„ì„  êµ¬ì¡°ë¥¼ ë¶„ëª…í•˜ê²Œ ì¸ì‹í•˜ê²Œ í•˜ì„¸ìš”.  
2. â€œì´ ì¥ë©´ì—ì„œ ë°°ë¹„ì¥ì€ ë¬´ì—‡ì„ ê°€ì¥ ë‘ë ¤ì›Œí•˜ëŠ”ê°€?â€ ê°™ì€ ì§ˆë¬¸ì„ ë˜ì ¸, ê°ì •ì˜ ì´ˆì ì„ ì°¾ê²Œ í•©ë‹ˆë‹¤.  
3. íƒœë„ ì„ ì§€ë¥¼ ë³¼ ë•ŒëŠ” ë‹¨ì–´ í•˜ë‚˜ì—ë§Œ ë°˜ì‘í•˜ì§€ ë§ê³ , ê·¸ ë‹¨ì–´ê°€ ì‘í’ˆ ì „ì²´ì—ì„œì˜ ë°°ë¹„ì¥ê³¼ ì–´ìš¸ë¦¬ëŠ”ì§€ ê²€ì¦í•˜ê²Œ ì§€ë„í•˜ì„¸ìš”.""",

    "ë¬¸í•™-ê³ ì „ì†Œì„¤(ë°°ë¹„ì¥ì „-ìƒí™©ì— ë§ëŠ” ì„±ì–´)": """### ğŸ“– ë¬¸í•™(ê³ ì „ì†Œì„¤): ìƒí™©ì— ë§ëŠ” ì„±ì–´ ì´í•´
**1. ì§„ë‹¨**  
ì„±ì–´ì˜ ëœ»ì€ ëŒ€ëµ ì•Œê³  ìˆì§€ë§Œ, **ì‘í’ˆ ì† êµ¬ì²´ì  ì¥ë©´ê³¼ ì„±ì–´ì˜ í•µì‹¬ ì´ë¯¸ì§€**ë¥¼ ì—°ê²°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¹„ìŠ·í•œ ì˜ë¯¸ì˜ ì„±ì–´ë¥¼ í˜¼ë™í–ˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

**2. Action Plan**  
1. ìì£¼ ë‚˜ì˜¤ëŠ” ì„±ì–´ë“¤ì˜ í•œì êµ¬ì„±ê³¼ ê¸°ë³¸ ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì •ë¦¬í•˜ê²Œ í•˜ì„¸ìš”. (ì˜ˆ: ììŠ¹ìë°• = ìŠ¤ìŠ¤ë¡œ ë§Œë“  ì˜¬ê°€ë¯¸ì— ê±¸ë¦¼)  
2. ì‘í’ˆ ì† ì¥ë©´ì„ í•œ ì¤„ë¡œ ìš”ì•½í•œ ë’¤, ê·¸ ìƒí™©ê³¼ ê°€ì¥ ì˜ ì–´ìš¸ë¦¬ëŠ” ì„±ì–´ë¥¼ ê³ ë¥´ëŠ” ì—°ìŠµì„ ì—¬ëŸ¬ ì‘í’ˆì— ê±¸ì³ ë°˜ë³µì‹œí‚¤ì„¸ìš”.  
3. ì„±ì–´ ë¬¸ì œë¥¼ í’€ ë•ŒëŠ” ë‹¨ì–´ ëœ»ë§Œ ë³´ì§€ ë§ê³ , **â€˜ëˆ„ê°€ ëˆ„êµ¬ì—ê²Œ ë¬´ì—‡ì„ í•´ì„œ ì–´ë–¤ ê¼´ì´ ë˜ì—ˆëŠ”ê°€â€™**ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•˜ë„ë¡ ì§€ë„í•˜ì„¸ìš”."""
}
def create_report_html(grade, round_name, name, score, rank, total_students, wrong_data_map, feedback_func):
    from datetime import datetime

    now = datetime.now().strftime("%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„")
    has_wrong = bool(wrong_data_map)
    feedback_section_html = ""

    if has_wrong:
        for title, q_nums in wrong_data_map.items():
            nums_str = ", ".join([str(n) for n in sorted(q_nums)]) + "ë²ˆ"

            msg = feedback_func(title)   # í•´ë‹¹ ìœ í˜•ì˜ í”¼ë“œë°± ê°€ì ¸ì˜¤ê¸°
            clean_msg = msg.strip().replace(">", "ğŸ’¡").replace("**", "").replace("-", "â€¢").replace("\n", "<br>")

            # ì œëª©ê³¼ ë³¸ë¬¸ ë¶„ë¦¬
            if clean_msg.startswith("###"):
                parts = clean_msg.split("<br>", 1)
                title_txt = parts[0].replace("###", "").strip()
                body_txt = parts[1] if len(parts) > 1 else ""
                feedback_section_html += f"""
                <div class='feedback-card'>
                    <div class='card-header'>
                        <span class='card-title'>{title_txt}</span>
                        <span class='card-nums'>âŒ í‹€ë¦° ë²ˆí˜¸: {nums_str}</span>
                    </div>
                    <div class='card-body'>{body_txt}</div>
                </div>
                """
            else:
                feedback_section_html += f"""
                <div class='feedback-card'>
                    <div class='card-header'>
                        <span class='card-title'>{title}</span>
                        <span class='card-nums'>âŒ í‹€ë¦° ë²ˆí˜¸: {nums_str}</span>
                    </div>
                    <div class='card-body'>{clean_msg}</div>
                </div>
                """

    else:
        feedback_section_html = """
        <div class='feedback-card' style='border-color:#4CAF50; background:#E8F5E9;'>
            <h3 style='color:#2E7D32; margin:0;'>ğŸ‰ ì™„ë²½í•©ë‹ˆë‹¤!</h3>
            <p style='margin:10px 0 0 0;'>ì•½ì ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        """

    return f"""
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{name} ì„±ì í‘œ</title>
    <style>
        body {{ font-family: 'Malgun Gothic', sans-serif; padding: 20px; color: #333; }}
        .paper {{ max-width: 800px; margin: 0 auto; border: 2px solid #444; padding: 40px; }}
        h1 {{ text-align: center; border-bottom: 3px solid #444; padding-bottom: 20px; margin-bottom: 30px; }}
        .info-table {{ width: 100%; border-collapse: collapse; margin-bottom: 30px; }}
        .info-table th {{ background-color: #f4f4f4; border: 1px solid #999; padding: 12px; width: 20%; font-weight: bold; }}
        .info-table td {{ border: 1px solid #999; padding: 12px; text-align: center; }}
        .score {{ font-size: 36px; font-weight: bold; color: #D32F2F; }}
        .feedback-card {{ border: 1px solid #999; margin-bottom: 20px; page-break-inside: avoid; }}
        .card-header {{ background-color: #eee; padding: 10px 15px; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center; }}
        .card-title {{ font-size: 16px; font-weight: bold; }}
        .card-nums {{ font-size: 14px; color: #D32F2F; font-weight: bold; background: white; padding: 3px 8px; border-radius: 5px; border: 1px solid #ddd; }}
        .card-body {{ padding: 15px; font-size: 13px; line-height: 1.6; }}
        .footer {{ text-align: center; margin-top: 50px; font-size: 12px; color: #888; }}
    </style>
</head>
<body>
    <div class="paper">
        <h1>ğŸ“‘ {grade} {round_name} ë¶„ì„ ì„±ì í‘œ</h1>

        <table class="info-table">
            <tr>
                <th>ì´ ë¦„</th><td>{name}</td>
                <th>ì‘ì‹œì¼</th><td>{now}</td>
            </tr>
            <tr>
                <th>ì  ìˆ˜</th><td><span class="score">{int(score)}</span> ì </td>
                <th>ë“± ìˆ˜</th><td>{rank}ë“± / {total_students}ëª…</td>
            </tr>
        </table>

        <h3 style="border-bottom: 2px solid #ddd; padding-bottom: 10px;">
            ğŸ’Š ìœ í˜•ë³„ ì˜¤ë‹µ ë¶„ì„ ë° ì²˜ë°©
        </h3>

        {feedback_section_html}

        <div class="footer">
            ìœ„ í•™ìƒì˜ ëª¨ì˜ê³ ì‚¬ ê²°ê³¼ë¥¼ ì¦ëª…í•©ë‹ˆë‹¤.<br>
            Designed by AI Teacher
        </div>
    </div>
</body>
</html>
"""

def create_portfolio_html(grade, name, my_hist_df, weakness_stats, feedback_markdown_map):
    """
    grade: í•™ë…„ ë¬¸ìì—´ (ì˜ˆ: 'ì¤‘ 1í•™ë…„')
    name:  í•™ìƒ ì´ë¦„
    my_hist_df: í•´ë‹¹ í•™ìƒ ê¸°ë¡ df (Round, Score, Wrong_Types í¬í•¨)
    weakness_stats: [(ìœ í˜•ëª…, íšŸìˆ˜), ...]  (ë³´í†µ TOP3)
    feedback_markdown_map: {ìœ í˜•ëª…: í”¼ë“œë°±_ë§ˆí¬ë‹¤ìš´_ë¬¸ìì—´}
    """
    now = datetime.now().strftime("%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„")

    # 1) ì‘ì‹œ ê¸°ë¡ í…Œì´ë¸” HTML
    history_rows = ""
    for _, row in my_hist_df.iterrows():
        history_rows += f"""
        <tr>
            <td>{row['Round']}</td>
            <td>{row['Score']}</td>
            <td>{row.get('Wrong_Types', '')}</td>
        </tr>
        """

    # 2) ëˆ„ì  ì·¨ì•½ ìœ í˜• TOP3 í…Œì´ë¸”
    weakness_rows = ""
    for t, c in weakness_stats:
        # ë³´ê¸° ì¢‹ê²Œ "í™”ë²•(ë§í•˜ê¸° ì „ëµ)" â†’ "í™”ë²•: ë§í•˜ê¸° ì „ëµ"
        display_title = str(t).replace("(", ": ").replace(")", "")
        weakness_rows += f"""
        <tr>
            <td>{display_title}</td>
            <td>{c}íšŒ</td>
        </tr>
        """

    # 3) ìœ í˜•ë³„ ë§ì¶¤ ì²˜ë°© (ë§ˆí¬ë‹¤ìš´ â†’ ì œëª©/ë³¸ë¬¸ ë¶„ë¦¬ í›„ HTML)
    feedback_sections = ""
    for t, _ in weakness_stats:
        md = str(feedback_markdown_map.get(t, "")).strip()

        if md.startswith("###"):
            parts = md.split("\n", 1)
            title_txt = parts[0].replace("###", "").strip()
            body_txt = parts[1] if len(parts) > 1 else ""
        else:
            title_txt = t
            body_txt = md

        html_body = body_txt.replace("\n", "<br>")

        feedback_sections += f"""
        <div class="feedback-card">
            <div class="card-header">
                <span class="card-title">{title_txt}</span>
            </div>
            <div class="card-body">{html_body}</div>
        </div>
        """

    # ìµœì¢… HTML
    return f"""
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{grade} {name} í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬í¬íŠ¸</title>
    <style>
        body {{ font-family: 'Malgun Gothic', sans-serif; padding: 20px; color: #333; }}
        h1 {{ text-align: center; border-bottom: 3px solid #444; padding-bottom: 20px; margin-bottom: 30px; }}
        h2 {{ margin-top: 30px; border-bottom: 2px solid #999; padding-bottom: 8px; }}
        table {{ width: 100%; border-collapse: collapse; margin-top: 10px; }}
        th, td {{ border: 1px solid #999; padding: 8px; text-align: center; font-size: 13px; }}
        th {{ background-color: #f4f4f4; }}
        .feedback-card {{ border: 1px solid #999; margin-top: 15px; page-break-inside: avoid; }}
        .card-header {{ background-color: #eee; padding: 8px 12px; border-bottom: 1px solid #ccc; }}
        .card-title {{ font-weight: bold; }}
        .card-body {{ padding: 12px; font-size: 13px; line-height: 1.6; }}
        .meta {{ font-size: 12px; color: #666; text-align:right; margin-bottom: 10px; }}
    </style>
</head>
<body>
    <h1>ğŸ“ˆ {grade} {name} í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬í¬íŠ¸</h1>
    <div class="meta">ìƒì„± ì‹œê°: {now}</div>

    <h2>1ï¸âƒ£ ì‘ì‹œ ê¸°ë¡ ìš”ì•½</h2>
    <table>
        <thead>
            <tr>
                <th>íšŒì°¨</th>
                <th>ì ìˆ˜</th>
                <th>ì˜¤ë‹µ ìœ í˜•</th>
            </tr>
        </thead>
        <tbody>
            {history_rows}
        </tbody>
    </table>

    <h2>2ï¸âƒ£ ëˆ„ì  ì·¨ì•½ ìœ í˜• TOP3</h2>
    <table>
        <thead>
            <tr>
                <th>ìœ í˜•</th>
                <th>ëˆ„ì  ì˜¤ë‹µ íšŸìˆ˜</th>
            </tr>
        </thead>
        <tbody>
            {weakness_rows}
        </tbody>
    </table>

    <h2>3ï¸âƒ£ ìœ í˜•ë³„ ë§ì¶¤ ì²˜ë°©</h2>
    {feedback_sections}

</body>
</html>
"""
    
def get_feedback_message_list(question_type, use_general=True):
    messages = []
    q = str(question_type).strip()

    if q in FEEDBACK_BY_TYPE:
        messages.append(FEEDBACK_BY_TYPE[q])

    if use_general and "ë¬¸ë²•" in question_type or "ë¬¸ì¥" in question_type:
        if "ìŒìš´" not in question_type and "ì‚¬ì „" not in question_type and "ì¤‘ì„¸" not in question_type:
            messages.append("""### ğŸ—ï¸ ë¬¸ë²•: ë¬¸ì¥ì˜ 'ë¼ˆëŒ€' ì°¾ê¸°
ë¬¸ì¥ ì„±ë¶„ ë¶„ì„ê³¼ ì¡°ì‚¬ì˜ ì“°ì„ì„ ë†“ì³¤ìŠµë‹ˆë‹¤.
â†’ ì„œìˆ ì–´ í™•ì¸ â†’ í•„ìˆ˜ ì„±ë¶„(ì£¼ì–´Â·ëª©ì ì–´Â·ë³´ì–´) ì ê²€""")

    if use_general and "ì‚¬ì „" in question_type:
        messages.append("""### ğŸ“– ë¬¸ë²•: ì‚¬ì „ ì •ë³´
í’ˆì‚¬ / ë¬¸í˜• / ì˜ˆë¬¸ ì—°ê²°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.
â†’ í’ˆì‚¬ ë¨¼ì € ì²´í¬ í›„ ì˜ˆë¬¸ ë¹„êµ""")

    if use_general and "ìŒìš´" in question_type:
        messages.append("""### ğŸ›‘ ë¬¸ë²•: ìŒìš´ ë³€ë™
â€˜ìœ í˜•â€™ë³´ë‹¤ â€˜í™˜ê²½â€™ì„ ë¨¼ì € ë´ì•¼ í•©ë‹ˆë‹¤.
â†’ ë°›ì¹¨+ììŒ / ë°›ì¹¨+ëª¨ìŒ / ã„·Â·ã…Œ+ì´ êµ¬ì¡° ë¨¼ì € í™•ì¸""")

    if use_general and "ì² í•™" in question_type or "ì¸ë¬¸" in question_type:
        messages.append("""### ğŸ§  ì¸ë¬¸/ì² í•™
ì‚¬ìƒê°€ë³„ ê¸°ì¤€ê³¼ ìš©ì–´ê°€ ì„ì˜€ìŠµë‹ˆë‹¤.
â†’ ê³µí†µì /ì°¨ì´ì  í‘œë¡œ ì •ë¦¬ + í‚¤ì›Œë“œ í•œ ì¤„ ìš”ì•½""")

    if use_general and "ê²½ì œ" in question_type or "ì‚¬íšŒ" in question_type:
        messages.append("""### ğŸ“ˆ ì‚¬íšŒ/ê²½ì œ
ì›ì¸ â†’ ê³¼ì • â†’ ê²°ê³¼ íë¦„ì„ ëª» ë´¤ìŠµë‹ˆë‹¤.
â†’ ê¸ˆë¦¬â†‘ â†’ ì†Œë¹„â†“ â†’ ê²½ê¸°â†“ ì²˜ëŸ¼ í™”ì‚´í‘œ ì •ë¦¬""")

    if use_general and "ì†Œì„¤" in question_type or "ì„œì‚¬" in question_type:
        messages.append("""### ğŸ­ ë¬¸í•™(ì‚°ë¬¸)
ê°ˆë“± ì§€ì ì„ ëª» ì¡ì•˜ìŠµë‹ˆë‹¤.
â†’ ì¸ë¬¼ê´€ê³„ë„ + ë§/í–‰ë™ ë³€í™” í‘œì‹œ""")

    if use_general and "ì‹œê°€" in question_type:
        messages.append("""### ğŸŒ™ ë¬¸í•™(ìš´ë¬¸)
ê°ì •ì–´ê°€ ì•„ë‹ˆë¼ â€˜ê´€ê³„/ìƒí™©â€™ì„ ë´ì•¼ í•©ë‹ˆë‹¤.
â†’ í™”ì-ëŒ€ìƒ-ìƒí™© í•œ ë¬¸ì¥ ì •ë¦¬""")

    if use_general and "í™”ë²•" in question_type:
        messages.append("""### ğŸ—£ï¸ í™”ë²•
ì „ë‹¬ â€˜ë°©ì‹/ì „ëµâ€™ì„ ëª» ë´¤ìŠµë‹ˆë‹¤.
â†’ ê°•ì¡°/ë¹„êµ/ì§ˆë¬¸/ì˜ˆì‹œ í‘œì‹œ""")

    if use_general and "ë§¤ì²´" in question_type:
        messages.append("""### ğŸ–¥ï¸ ë§¤ì²´
ê¸°ëŠ¥ê³¼ íš¨ê³¼ ì—°ê²°ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.
â†’ ëŒ“ê¸€/ë§í¬/ê·¸ë˜í”„ = ì–´ë–¤ íš¨ê³¼?""")

    if use_general and  "ë³´ê¸°" in question_type:
        messages.append("""### ğŸ”¥ ë³´ê¸° ì ìš©
ì§€ë¬¸ ê°œë… â†’ ë³´ê¸° ìƒí™© ë²ˆì—­ ì‹¤íŒ¨
â†’ ë³´ê¸° ë‹¨ì–´ë¥¼ ì§€ë¬¸ ìš©ì–´ë¡œ ì¹˜í™˜""")

    if not messages:
        messages.append("### âš ï¸ ê¸°ì´ˆ ë…í•´ë ¥ â†’ ê·¼ê±°ë¶€í„° ì¬í™•ì¸")

    return messages


# --------------------------------------------------
# [6] íƒ­ êµ¬ì„±
# --------------------------------------------------
tab1, tab2, tab3 = st.tabs(["ğŸ“ ì‹œí—˜ ì‘ì‹œ", "ğŸ” ì„±ì  ì¡°íšŒ", "ğŸ“ˆ í¬íŠ¸í´ë¦¬ì˜¤"])
active_grades = [g for g in GRADE_ORDER if g in EXAM_DB]


# ==================================================
# [íƒ­ 1] ì‹œí—˜ ì‘ì‹œ
# ==================================================
with tab1:
    st.header("ì‹œí—˜ ì‘ì‹œ")

    if not active_grades:
        st.error("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
    else:
        exam_tabs = st.tabs(active_grades)

        for i, grade in enumerate(active_grades):
            with exam_tabs[i]:
                rounds = list(EXAM_DB[grade].keys())
                selected_round = st.selectbox("íšŒì°¨", rounds, key=f"ex_r_{grade}")
                current_exam_data = EXAM_DB[grade][selected_round]

                with st.form(f"form_{grade}_{selected_round}"):

                    nm = st.text_input("ì´ë¦„")
                    sid = st.text_input("í•™ë²ˆ")

                    user_answers = {}
                    for q, info in current_exam_data.items():
                        user_answers[q] = st.radio(
                            f"{q}ë²ˆ ({info['score']}ì )",
                            [1,2,3,4,5],
                            horizontal=True,
                            index=None
                        )

                    submit = st.form_submit_button("ì œì¶œ")

                if submit:
                    sheet = get_student_sheet()
                    if not sheet:
                        st.error("ì‹œíŠ¸ ì—°ê²° ì‹¤íŒ¨")
                        continue

                    total_score = 0
                    wrong_list = []
                    wrong_q = []

                    for q, info in current_exam_data.items():
                        if user_answers.get(q) == info['ans']:
                            total_score += info['score']
                        else:
                            wrong_list.append(info['type'])
                            wrong_q.append(str(q))

                    w_q_str = ", ".join(wrong_q) if wrong_q else "ì—†ìŒ"

                    # âœ… ê´€ë¦¬ì ì •ë³´ ê°™ì´ ì €ì¥
                    new_row = [
                        grade,
                        selected_round,
                        sid,
                        nm,
                        total_score,
                        " | ".join(wrong_list),
                        datetime.now().strftime("%Y-%m-%d %H:%M"),
                        w_q_str,
                        current_admin
                    ]

                    sheet.append_row(new_row)

                    st.success(f"{nm}ì ìˆ˜: {total_score}ì  ì €ì¥ ì™„ë£Œ!")


# ==================================================
# [íƒ­ 2] ì„±ì  ì¡°íšŒ
# ==================================================
with tab2:
    st.header("ì„±ì  ì¡°íšŒ")

    res_tabs = st.tabs(active_grades)

    def render_result(grade):
        rounds = list(EXAM_DB[grade].keys())
        c1, c2 = st.columns(2)
        chk_rd = c1.selectbox("íšŒì°¨", rounds, key=f"res_r_{grade}")
        chk_id = c2.text_input("í•™ë²ˆ", key=f"res_i_{grade}")
    
        if st.button("ì¡°íšŒ", key=f"res_b_{grade}"):
        # ğŸ‘‰ í•™ìƒ ë°ì´í„° ë¡œë”© (ë„ˆ ì§€ê¸ˆ ì“°ëŠ” ë°©ì‹ ê·¸ëŒ€ë¡œë©´ ì—¬ê¸°ë§Œ df ë§Œë“œëŠ” ë¶€ë¶„ ë§ì¶°ì£¼ë©´ ë¨)
            sheet = get_student_sheet()
            if sheet:
                try:
                    recs = sheet.get_all_records()
                    df = pd.DataFrame(recs)
                    df['Grade'] = df['Grade'].astype(str).str.strip()
                    df['Round'] = df['Round'].astype(str).str.strip()
                    df['ID'] = df['ID'].astype(str)
    
                    def norm(v):
                        try:
                            return str(int(v))
                        except:
                            return str(v).strip()
    
                    df['ID_Clean'] = df['ID'].apply(norm)
                    in_id = norm(chk_id)
                    
                    my_data = df[
                        (df['Grade'] == str(grade)) &
                        (df['Round'] == str(chk_rd)) &
                        (df['ID_Clean'] == in_id)
                    ]
                    
                    if not my_data.empty:
                        last_row = my_data.iloc[-1]
                        
                        r_data = df[(df['Grade'] == str(grade)) & (df['Round'] == str(chk_rd))]
                        rank = r_data[r_data['Score'] > last_row['Score']].shape[0] + 1
                        total = len(r_data)
                        pct = (rank / total) * 100
                        
                        st.divider()
                        st.subheader(f"ğŸ“¢ {grade} {last_row['Name']}ë‹˜ì˜ ê²°ê³¼")
                        m1, m2, m3 = st.columns(3)
                        m1.metric("ì ìˆ˜", f"{int(last_row['Score'])}")
                        m2.metric("ë“±ìˆ˜", f"{rank} / {total}")
                        m3.metric("ìƒìœ„", f"{pct:.1f}%")
                        
                        w_q_str = str(last_row.get('Wrong_Questions', ''))
                        w_nums = [int(x.strip()) for x in w_q_str.split(",") if x.strip().isdigit()] if w_q_str != "ì—†ìŒ" else []
                        
                        st.markdown("---")
                        if w_nums:
                            st.error(f"âŒ **í‹€ë¦° ë¬¸ì œ:** {w_q_str}ë²ˆ")
                        else:
                            st.success("ë§Œì ì…ë‹ˆë‹¤!")
                        
                        # ================================
                        # ğŸ”’ ì—¬ê¸°ë¶€í„° ê´€ë¦¬ì ìƒì„¸ í”¼ë“œë°±
                        # ================================
                        if is_admin:
                            st.info("ğŸ”’ ìƒì„¸ ë¶„ì„ (ê´€ë¦¬ì ì „ìš©)")
    
                            curr_db = EXAM_DB[grade][chk_rd]
    
                            # 1) ë™ì¼í•œ í”¼ë“œë°± ë‚´ìš©ë¼ë¦¬ ë¬¶ê¸°: msg(í”¼ë“œë°± ë¬¸ìì—´) -> [ë¬¸í•­ ë²ˆí˜¸ ë¦¬ìŠ¤íŠ¸]
                            feedback_group = {}
    
                            for q in w_nums:
                                if q not in curr_db:
                                    continue
                                qt = curr_db[q]['type']          # ì´ ë¬¸í•­ì˜ Type (ì˜ˆ: "í™”ë²•(ê°•ì—°-ë§í•˜ê¸° ì „ëµ)")
                                msgs = get_feedback_message_list(qt, use_general=False)
                                if not msgs:
                                    msgs = get_feedback_message_list(qt, use_general=True)
    
                                for msg in msgs:
                                    key = msg.strip()
                                    if key not in feedback_group:
                                        feedback_group[key] = []
                                    if q not in feedback_group[key]:
                                        feedback_group[key].append(q)
    
                            # 2) í™”ë©´ì— ì¶œë ¥
                            if feedback_group:
                                st.write("### ğŸ’¡ ìœ í˜•ë³„ ìƒì„¸ í”¼ë“œë°±")
    
                                for i, (msg, nums) in enumerate(feedback_group.items()):
                                    nums = sorted(nums)
                                    n_txt = ", ".join(map(str, nums))
    
                                    raw = msg.strip()
                                    # ì œëª© / ë³¸ë¬¸ ë¶„ë¦¬ (### ì²« ì¤„ì„ ì œëª©ìœ¼ë¡œ ì‚¬ìš©)
                                    if raw.startswith("###"):
                                        first_line, *rest = raw.split("\n", 1)
                                        title = first_line.replace("###", "").strip()
                                    else:
                                        title = "ìƒì„¸ í”¼ë“œë°±"
    
                                    label = f"âŒ **{title}**  (í‹€ë¦° ë²ˆí˜¸: {n_txt}ë²ˆ)"
    
                                    with st.expander(label, expanded=(i == 0)):
                                        st.markdown(msg)
    
                            # 3) ì„±ì í‘œ(html) ë‹¤ìš´ë¡œë“œìš© ë§¤í•‘ (ì œëª© -> ë¬¸í•­ ë²ˆí˜¸ / ë©”ì‹œì§€)
                            report_map = {}
                            title_to_msg = {}
                            for msg, nums in feedback_group.items():
                                t = msg.strip().split('\n')[0].replace("###", "").strip() if "###" in msg else "ê¸°íƒ€"
                                report_map[t] = nums
                                title_to_msg[t] = msg
    
                            st.markdown("---")
                            st.write("### ğŸ’¾ ì €ì¥")
    
                            rpt = create_report_html(
                                grade,
                                chk_rd,
                                last_row['Name'],
                                last_row['Score'],
                                rank,
                                total,
                                report_map,
                                lambda x: title_to_msg.get(x, "")
                            )
                            html_bytes = rpt.encode("utf-8")
    
                            st.download_button(
                                "ğŸ“¥ ë‹¤ìš´ë¡œë“œ",
                                html_bytes,
                                file_name="report.html",
                                mime="text/html; charset=utf-8",
                                key=f"d_{grade}_{chk_id}"
                            )
                        else:
                            st.warning("ğŸ”’ ìƒì„¸ ë¶„ì„ê³¼ ì„±ì í‘œëŠ” ì„ ìƒë‹˜ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
    
                    else:
                        st.error("ê¸°ë¡ ì—†ìŒ")
                except Exception as e:
                    st.error(f"ì˜¤ë¥˜: {e}")
    for i, g in enumerate(active_grades):
        with res_tabs[i]:
            render_result(g)


# ==================================================
# [íƒ­ 3] í¬íŠ¸í´ë¦¬ì˜¤
# ==================================================
with tab3:
    st.header("í¬íŠ¸í´ë¦¬ì˜¤")

    # í•™ë…„ / í•™ë²ˆ ì…ë ¥
    pg = st.selectbox("í•™ë…„", active_grades)
    pid = st.text_input("í•™ë²ˆ")

    if st.button("ë¶„ì„"):

        sheet = get_student_sheet()
        if not sheet:
            st.error("ì‹œíŠ¸ ì˜¤ë¥˜")
            st.stop()

        # ì „ì²´ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        df = pd.DataFrame(sheet.get_all_records())

        # AdminID ì»¬ëŸ¼ì´ ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
        df["AdminID"] = df.get("AdminID", "").astype(str)

        # ìµœì¢…ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´, ìì‹ ì˜ AdminIDë¡œë§Œ í•„í„°
        if not is_superadmin:
            df = df[df["AdminID"] == current_admin]

        df["ID"] = df["ID"].astype(str).str.strip()
        df["Grade"] = df["Grade"].astype(str).str.strip()

        # í•´ë‹¹ í•™ìƒì˜ ê¸°ë¡ë§Œ ì¶”ì¶œ
        my_hist = df[(df["Grade"] == pg) & (df["ID"] == pid)]

        if my_hist.empty:
            st.warning("ê¸°ë¡ ì—†ìŒ")
            st.stop()

        name = my_hist.iloc[-1]["Name"]

        st.success(f"{pg} {name} ì„±ì¥ ê¸°ë¡")

        # ì ìˆ˜ ì¶”ì´ ì°¨íŠ¸
        chart = alt.Chart(my_hist).mark_line(point=True).encode(
            x="Round",
            y="Score"
        )
        st.altair_chart(chart, use_container_width=True)

        # -----------------------------
        # 1) ëˆ„ì  ì˜¤ë‹µ ìœ í˜• ì§‘ê³„
        # -----------------------------
        all_wrong = []
        for _, r in my_hist.iterrows():
            wt = str(r.get("Wrong_Types", "")).strip()
            if wt:
                all_wrong += wt.split(" | ")

        from collections import Counter
        cnt = Counter(all_wrong).most_common() if all_wrong else []

        # -----------------------------
        # 2) í”¼ë“œë°± ë‚´ìš© ê¸°ì¤€ìœ¼ë¡œ ì¤‘ë³µ ì œê±°ëœ TOP3 ì„ íƒ
        #    (ê°™ì€ ë‚´ìš©ì˜ í”¼ë“œë°±ì´ë©´ í•œ ë²ˆë§Œ)
        # -----------------------------
        selected = []      # [(ìœ í˜•ëª…, íšŸìˆ˜), ...]
        seen_msgs = set()  # í”¼ë“œë°± ì „ì²´ ë¬¸ìì—´ ê¸°ì¤€ ì¤‘ë³µ ì²´í¬

        for t, c in cnt:
            msgs = get_feedback_message_list(t, use_general=False)
            if not msgs:
                msgs = get_feedback_message_list(t, use_general=True)
            # íƒ€ì… tì— ëŒ€í•œ í”¼ë“œë°±(ì—¬ëŸ¬ ê°œì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ join)
            full_md = "\n".join(msgs)

            if full_md in seen_msgs:
                continue

            seen_msgs.add(full_md)
            selected.append((t, c))

            if len(selected) >= 3:
                break

        st.markdown("### ì·¨ì•½ ìœ í˜• (í”¼ë“œë°± ê¸°ì¤€ TOP3)")

        feedback_map = {}  # {ìœ í˜•ëª…: í”¼ë“œë°±_ë§ˆí¬ë‹¤ìš´}

        if selected:
            # ì™¼ìª½: ìœ í˜• + íšŸìˆ˜, ì˜¤ë¥¸ìª½: ìƒì„¸ í”¼ë“œë°±
            c_left, c_right = st.columns([1, 1.5])

            with c_left:
                for t, c in selected:
                    # ë³´ê¸° ì¢‹ê²Œ "í™”ë²•(ë§í•˜ê¸° ì „ëµ)" â†’ "í™”ë²•: ë§í•˜ê¸° ì „ëµ"
                    display_title = str(t).replace("(", ": ").replace(")", "")
                    st.write(f"- **{display_title}** ({c}íšŒ)")

            with c_right:
                st.info("ğŸ’¡ ìœ í˜•ë³„ ìƒì„¸ í”¼ë“œë°±")
                for idx, (t, c) in enumerate(selected):
                    msgs = get_feedback_message_list(t, use_general=False)
                    if not msgs:
                        msgs = get_feedback_message_list(t, use_general=True)
                    full_md = "\n".join(msgs)
                    feedback_map[t] = full_md
                    display_title = str(t).replace("(", ": ").replace(")", "")
                    with st.expander(f"{display_title} ì²˜ë°©ì „", expanded=(idx == 0)):
                        st.markdown(full_md)

        else:
            st.info("âœ… ëˆ„ì  ì·¨ì•½ ìœ í˜•ì´ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.")

        # -----------------------------
        # 3) í¬íŠ¸í´ë¦¬ì˜¤ HTML ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
        # -----------------------------
        st.markdown("---")
        st.write("### ğŸ“¥ í¬íŠ¸í´ë¦¬ì˜¤ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ")

        if selected:
            # create_portfolio_html ì‚¬ìš© (ë¯¸ë¦¬ ì •ì˜í•´ ë‘” í•¨ìˆ˜)
            html_report = create_portfolio_html(
                grade=pg,
                name=name,
                my_hist_df=my_hist[['Round', 'Score', 'Wrong_Types']],
                weakness_stats=selected,
                feedback_markdown_map=feedback_map
            )

            html_bytes = html_report.encode("utf-8")

            st.download_button(
                "ğŸ“¥ í¬íŠ¸í´ë¦¬ì˜¤ ë‹¤ìš´ë¡œë“œ",
                html_bytes,
                file_name=f"{name}_portfolio.html",
                mime="text/html; charset=utf-8",
                key=f"dl_port_{pg}_{pid}"
            )
        else:
            st.info("ì €ì¥í•  ì·¨ì•½ ìœ í˜• ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        # --------------------------------
        # 4) (ìµœê³ ê´€ë¦¬ì ì „ìš©) ê´€ë¦¬ìë³„ ì…ë ¥ í˜„í™©
        # --------------------------------
        if is_superadmin:
            st.markdown("---")
            st.subheader("ğŸ‘€ ê´€ë¦¬ìë³„ ì…ë ¥ í˜„í™© (ìµœê³ ê´€ë¦¬ì ì „ìš©)")
    
            sheet2 = get_student_sheet()
            if not sheet2:
                st.error("ì‹œíŠ¸ ì˜¤ë¥˜")
            else:
                df_all = pd.DataFrame(sheet2.get_all_records())
    
                if "AdminID" not in df_all.columns:
                    st.info("âš  AdminID ì»¬ëŸ¼ì´ ì—†ì–´ ê´€ë¦¬ìë³„ ì§‘ê³„ë¥¼ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
                else:
                    # ë¬¸ìì—´ ì •ë¦¬
                    df_all["AdminID"] = df_all["AdminID"].astype(str).str.strip()
                    df_all["Grade"] = df_all["Grade"].astype(str).str.strip()
                    df_all["ID"] = df_all["ID"].astype(str).str.strip()
                    df_all["Name"] = df_all["Name"].astype(str).str.strip()
                    df_all["Round"] = df_all["Round"].astype(str).str.strip()
    
                    # ë‚ ì§œ ì»¬ëŸ¼ ì´ë¦„ì´ Dateì¸ì§€ Timestampì¸ì§€ ì• ë§¤í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì²˜ë¦¬
                    date_col = None
                    for cand in ["Date", "Timestamp", "CreatedAt"]:
                        if cand in df_all.columns:
                            date_col = cand
                            break
    
                    # ê´€ë¦¬ìë³„ Â· í•™ìƒë³„ ì§‘ê³„
                    group_cols = ["AdminID", "Grade", "ID", "Name"]
                    agg_dict = {"Round": "nunique"}
                    if date_col:
                        agg_dict[date_col] = "max"
    
                    summary = df_all.groupby(group_cols).agg(agg_dict).reset_index()
                    summary = summary.rename(columns={
                        "Round": "ì‘ì‹œíšŒì°¨ìˆ˜"
                    })
                    if date_col:
                        summary = summary.rename(columns={date_col: "ìµœê·¼ì‘ì‹œì¼"})
    
                    # ê´€ë¦¬ì ì„ íƒ
                    admin_list = sorted(summary["AdminID"].unique())
                    sel_admin = st.selectbox("ê´€ë¦¬ì ì„ íƒ", admin_list, key="admin_summary_sel")
    
                    view = summary[summary["AdminID"] == sel_admin].copy()
                    view = view.sort_values(["Grade", "ID"])
    
                    st.write(f"**{sel_admin}** ê´€ë¦¬ìê°€ ì…ë ¥í•œ í•™ìƒ ìˆ˜: **{view.shape[0]}ëª…**")
    
                    st.dataframe(
                        view[
                            ["Grade", "ID", "Name", "ì‘ì‹œíšŒì°¨ìˆ˜"]
                            + (["ìµœê·¼ì‘ì‹œì¼"] if "ìµœê·¼ì‘ì‹œì¼" in view.columns else [])
                        ]
                    )
